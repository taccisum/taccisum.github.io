<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5J42R3VH2D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5J42R3VH2D');
</script>

  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.7.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"taccisum.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言DDD 全称领域驱动设计，最初由 Eric Evans 提出。此文章仅探讨 DDD 在 Java 服务端的落地可行性简要方案，以期不需要太过复杂的前期准备也能够快速在项目中运用 DDD 编写代码 注意，此文章：  假定读者有一定的 DDD 理论基础 假定读者有 Java 服务端开发经验，并掌握主流的开发框架（如 Spring），本文的许多章节将会结合这些框架进行实现 以经典的 RBAC 权限模">
<meta property="og:type" content="article">
<meta property="og:title" content="DDD 战术设计之 Java 服务端落地简要方案探讨">
<meta property="og:url" content="https://taccisum.github.io/ddd_practice_in_java_server_side.html">
<meta property="og:site_name" content="Taccisum&#39;s blog 😉">
<meta property="og:description" content="前言DDD 全称领域驱动设计，最初由 Eric Evans 提出。此文章仅探讨 DDD 在 Java 服务端的落地可行性简要方案，以期不需要太过复杂的前期准备也能够快速在项目中运用 DDD 编写代码 注意，此文章：  假定读者有一定的 DDD 理论基础 假定读者有 Java 服务端开发经验，并掌握主流的开发框架（如 Spring），本文的许多章节将会结合这些框架进行实现 以经典的 RBAC 权限模">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2023-01-04T08:26:00.717Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DDD 战术设计之 Java 服务端落地简要方案探讨">
<meta name="twitter:description" content="前言DDD 全称领域驱动设计，最初由 Eric Evans 提出。此文章仅探讨 DDD 在 Java 服务端的落地可行性简要方案，以期不需要太过复杂的前期准备也能够快速在项目中运用 DDD 编写代码 注意，此文章：  假定读者有一定的 DDD 理论基础 假定读者有 Java 服务端开发经验，并掌握主流的开发框架（如 Spring），本文的许多章节将会结合这些框架进行实现 以经典的 RBAC 权限模">

<link rel="canonical" href="https://taccisum.github.io/ddd_practice_in_java_server_side.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>DDD 战术设计之 Java 服务端落地简要方案探讨 | Taccisum's blog 😉</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Taccisum's blog 😉</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/ddd_practice_in_java_server_side.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog 😉">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          DDD 战术设计之 Java 服务端落地简要方案探讨
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-11-16 16:04:22" itemprop="dateCreated datePublished" datetime="2021-11-16T16:04:22+08:00">2021-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-04 16:26:00" itemprop="dateModified" datetime="2023-01-04T16:26:00+08:00">2023-01-04</time>
              </span>

          
            <span id="/ddd_practice_in_java_server_side.html" class="post-meta-item leancloud_visitors" data-flag-title="DDD 战术设计之 Java 服务端落地简要方案探讨" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/ddd_practice_in_java_server_side.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/ddd_practice_in_java_server_side.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>DDD 全称<strong>领域驱动设计</strong>，最初由 Eric Evans 提出。此文章仅探讨 DDD 在 Java 服务端的落地可行性简要方案，以期不需要太过复杂的前期准备也能够快速在项目中运用 DDD 编写代码</p>
<p>注意，此文章：</p>
<ul>
<li>假定读者有一定的 DDD 理论基础</li>
<li>假定读者有 Java 服务端开发经验，并掌握主流的开发框架（如 Spring），本文的许多章节将会结合这些框架进行实现</li>
<li>以经典的 RBAC 权限模型为示例进行 DDD 建模</li>
</ul>
<h3 id="DDD-编写的代码所属层次"><a href="#DDD-编写的代码所属层次" class="headerlink" title="DDD 编写的代码所属层次"></a>DDD 编写的代码所属层次</h3><p>我们把 DDD 设计的相关代码放到 Domain 层，这一层是介于经典三层架构中 Service 与 DAO 层之间的特殊的一层，但严格意义上来说还是属于 Service 层（处理业务逻辑），可以想象成在原先的 Service 层上又划分了一层出来。</p>
<p>如下图所示</p>
<p>TODO::</p>
<p>示例<br>下面是我们在 JAVA 工程中采用的一个 DDD 包结构规范</p>
<p>TODO::</p>
<p>如果是现有项目，可以在与 controller, service 平级的 package 中再创建一个 domain，这样做的好处是不需要改动现有代码，domain 与 service 可以共存</p>
<p>TODO::</p>
<p>也可以设计得更复杂，但成本较高，一般建议在新的、核心的项目中使用</p>
<p>TODO::</p>
<h2 id="核心概念的落地"><a href="#核心概念的落地" class="headerlink" title="核心概念的落地"></a>核心概念的落地</h2><h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><blockquote>
<p>以标识作为其基本定义的对象称为实体 - Eric Evans </p>
</blockquote>
<p>实体至少有两个字段：唯一标识 <code>id</code> 和 负责该实体持久化工作的 <code>DAO</code>。</p>
<p>服务端比较流行 ORM 框架（如 MyBatis），这些框架操作的数据对象（DO）往往是一些纯数据模型，不适合将实体与 DO 混用，最好是以实体依赖 DO 的方式设计，将 DO 定位为存储实体属性的承载者</p>
<p>最终得到一个最小的实体定义如下：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> UserDAO dao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">User</span><span class="token punctuation">(</span>Long id<span class="token punctuation">,</span> UserDAO dao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dao <span class="token operator">=</span> dao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> UserDO <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" say: hello."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用时的代码如下</p>
<pre class="line-numbers language-java"><code class="language-java">User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>1L<span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>实际项目中，实体往往还有很多其它依赖，而且随着业务的发展依赖还会不断增多。依赖多了以后，实体的构造就成了一个大问题，不可能再以 new 的方式去创建实体。因此，需要引入工厂的概念，这将在下文讨论</p>
<h4 id="实体与数据对象的关系"><a href="#实体与数据对象的关系" class="headerlink" title="实体与数据对象的关系"></a>实体与数据对象的关系</h4><p>初学者的经常存在一个误区是，喜欢把实体与数据对象（或者说数据库表设计）一一对应起来。这种观念一定要纠正过来，在这里给出的建议是：实体的设计要更多从业务概念的角度去考虑（比如从技术的角度可能会细分出 user_info, user_ext, user_login_history 等等数据对象，但从业务的角度其实都应该是对应到用户这一个实体）。</p>
<p>常见的有以下情况</p>
<ul>
<li>一个实体的属性拆分为多张表存储</li>
<li>实体之间的关联关系信息</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDAO</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> UserInfoMapper userInfoMapper<span class="token punctuation">;</span>
    <span class="token keyword">private</span> UserExtMapper userExtMapper<span class="token punctuation">;</span>
    <span class="token keyword">private</span> UserLoginHistoryMapper userLoginHistoryMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> UserDO <span class="token function">selectById</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">build</span><span class="token punctuation">(</span>
            userInfoMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            userExtMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
            userLoginHistoryMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>多封装一层 DAO 可以屏蔽持久化的底层实现，方便后续替换（比如某天要对现有服务进行拆分，只需将 mapper 替换成 feign client 即可），但同时也会增加工作量。</p>
<p>一种更加简便的方式是直接在实体中引用 mapper 进行操作。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> UserInfoMapper userInfoMapper<span class="token punctuation">;</span>
    <span class="token keyword">private</span> UserExtMapper userExtMapper<span class="token punctuation">;</span>
    <span class="token keyword">private</span> UserLoginHistoryMapper userLoginHistoryMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> UserDO <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此外，出于高内聚考虑，实体不应该直接操作不属于自己管辖的数据对象。如，User 不应该通过 RoleMapper 直接操作 RoleDO</p>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p>考虑到在服务端开发中，有状态的对象朝生夕灭的情况非常常见（服务端要管理的对象非常多，不可能将所有实体都存在内存中，一般一个请求过来时会创建对象，请求结束后在下一次 GC 这个对象就会被销毁），而实体之间的关联可能是非常复杂的，每次使用时都构建一个完整的聚合非常不划算，比较建议实体间的聚合采用软关联的方式</p>
<p>可以看到以下两种方式的区别：</p>
<h5 id="硬关联"><a href="#硬关联" class="headerlink" title="硬关联"></a>硬关联</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>Role<span class="token operator">></span> roles<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">User</span><span class="token punctuation">(</span>Long id<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Role<span class="token operator">></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>roles <span class="token operator">=</span> roles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Role<span class="token operator">></span> <span class="token function">listAllRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="软关联"><a href="#软关联" class="headerlink" title="软关联"></a>软关联</h5><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> RoleRepository roleRepo<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">User</span><span class="token punctuation">(</span>Long id<span class="token punctuation">,</span> RoleRepository roleRepo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>roleRepo <span class="token operator">=</span> roleRepo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Role<span class="token operator">></span> <span class="token function">listAllRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roleRepo<span class="token punctuation">.</span><span class="token function">listAllByUserId</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>两者在使用方式并没有区别</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span>Role role <span class="token operator">:</span> user<span class="token punctuation">.</span><span class="token function">listAllRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    role<span class="token punctuation">.</span><span class="token function">dosomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="工厂"><a href="#工厂" class="headerlink" title="工厂"></a>工厂</h3><p>虽然在上面我们采用了软关联的方式建立实体之间的引用关系，但这并不代表要构建一个实体就非常简单了，原因是我们的实体除了依赖其它实体外，往往还需要依赖许多其它对象（如领域服务、仓储、DAO 等），并且随着业务的变化，实体的依赖往往还会随之发生变化，如果还是通过传统的 new 方式去创建一个实体，会产生一些灾难性的问题：</p>
<ul>
<li>使用者必须清楚实体的创建细节，这会大大增加代码的复杂度</li>
<li>每当实体的构造方式发生变化时，不得不调整所有创建实体的代码逻辑以解决代码编译问题</li>
</ul>
<p>这个时候就需要引入工厂（Factory）的概念了，一个通用 Factory 的实现示例如下</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> UserRepository userRepo<span class="token punctuation">;</span>

    <span class="token keyword">public</span> User <span class="token function">getUser</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> userRepo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结合 Spring，可以把实体的依赖注入做得更简单，并且在实体 User 的依赖变化后不需要做任何代码变更</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> User <span class="token function">getUser</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        SpringUtils<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">// 结合 AOP 可以进一步简化装配逻辑</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="实体仓储（Repository）-TODO"><a href="#实体仓储（Repository）-TODO" class="headerlink" title="实体仓储（Repository） TODO::"></a>实体仓储（Repository） TODO::</h3><p>仓储可以为使用者提供实体的创建、删除及条件查询操作。在 C/S 中，仓储还要负责内存中的实体的更新（保证数据一致性）及缓存管理（防止频繁地重复创建，影响性能）</p>
<p>在 B/S 架构中，我们将实体与数据对象分离，因此数据一致性问题交给 ORM 去控制即可，仓储</p>
<p>仓储往往依赖 DAO（查询持久化数据）及工厂（创建实体），并且应可以发布领域事件。</p>
<pre class="line-numbers language-java"><code class="language-java">
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="领域服务"><a href="#领域服务" class="headerlink" title="领域服务"></a>领域服务</h3><p>领域服务用于处理一些在概念上不属于实体的操作，这些操作本质上往往是一些活动或行为，并且是无状态的。对于这类操作，将其强制进行归类会显得非常别扭，于是便引入了领域服务这一概念。</p>
<p>需要明确的是，其与三层架构的 Service 层（业务逻辑层）并不是一个概念。另外与 Evans 在书中提及的示例不同，为了避免混乱，一般不建议为领域服务的类命名加上 Service 后缀。<br>可以简单理解为，领域中没有任何实体适合承载该职责，因此我们创造了一个『实体』来承担，只不过这个特殊的『实体』是一个无状态的单例而以。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>在某个应用中，由于用户量较大，用户登录历史可能会逐渐变得非常庞大，因此需要需要定时查找超过 15 天的记录并将其清理。</p>
<p>显然，我们需要完成的这个操作无法归类到任何一个实体中，因此我们需要一个名为 LoginHistoryClearer 的领域服务来承接此职责</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Compoment</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginHistoryClearer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> UserRepository userRepo<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearOutDated</span><span class="token punctuation">(</span>Integer interval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>User user <span class="token operator">:</span> userRepo<span class="token punctuation">.</span><span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">.</span><span class="token function">removeOutDatedLoginHistory</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在其它地方，我们可以直接注入该领域服务，并使用</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserScheduledTask</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> LoginHistoryClearer clearer<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${exec.output.interval.days:15}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Integer intervalDays<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 0 * * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteExecData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"starting clear out dated data, intervalDays=>{}"</span><span class="token punctuation">,</span> intervalDays<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clearer<span class="token punctuation">.</span><span class="token function">clearOutDated</span><span class="token punctuation">(</span>intervalDays<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"clear out dated data end"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="领域事件"><a href="#领域事件" class="headerlink" title="领域事件"></a>领域事件</h3><p>在我们的领域活动（实体、仓储等操作）中会出现一系列的重要的事件，而这些事件的订阅者，往往需要对这些事件作出响应（例如，新增用户后，可能会触发一系列动作：发送欢迎信息、发放优惠券等等）。领域事件可以简单地理解为是发布订阅模式在 DDD 中的一种运用。</p>
<p>在我们的实践中，一般采用事件总线来快速地发布一个领域事件。</p>
<p>事件总线的接口定义一般如下</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">post</span><span class="token punctuation">(</span>Event event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>通过调用 EventBus.post() 方法，我们可以快速发布一个事件。</p>
<p>同时我们还会提供一个抽象类 AbstractEventPublisher </p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AbstractEventPublisher</span> <span class="token keyword">implements</span> <span class="token class-name">EventPublisher</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> EventBus eventBus<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEventBus</span><span class="token punctuation">(</span>EventBus eventBus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus <span class="token operator">=</span> eventBus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span>Event event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventBus <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            eventBus<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"event bus is null. event "</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" will not be published!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EventPublisher</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span>Event event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这样我们可以让实体或 Manager 继承自 AbstractEventPublisher，其便有了发布事件的能力。至于如何订阅并处理这些事件，取决于 EventBus 的实现方式。举个例子，我们一般使用 Guava 的 EventBus，定义相关的 handler 并注册到 EventBus 中便可方便地处理这些事件</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DomainEventBus</span> <span class="token keyword">extends</span> <span class="token class-name">EventBus</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> FooEventHandler fooEventHandler<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>fooEventHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooEventHandler</span> <span class="token keyword">implements</span> <span class="token class-name">DomainEventHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Subscribe</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listen</span><span class="token punctuation">(</span>ProjectCreatEvent e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// do something here...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其它<br>TODO::<br>● ddd-support</p>
<h3 id="DDD-设计"><a href="#DDD-设计" class="headerlink" title="DDD 设计"></a>DDD 设计</h3><p>理解了 DDD 中的全部概念，也并不意味着就能做出一个好的设计了。</p>
<!-- DDD 设计中最重要的其实是实体的定义， -->
<p>DDD 的设计最重要的是做好以下几点：</p>
<ol>
<li>准确地定义实体</li>
<li>准确地定义实体应该有哪些方法</li>
<li>确立实体与实体之间的关系</li>
</ol>
<p>实体的设计其实是一个建模的过程。面向对象的设计方法本质就是将现实世界的对象关系以简化的形式提炼为模型。关于这一块，已经是一个更大的话题了，不在这里讨论。</p>
<p>案例工程<br>TODO::</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="与现有三层架构是否冲突"><a href="#与现有三层架构是否冲突" class="headerlink" title="与现有三层架构是否冲突"></a>与现有三层架构是否冲突</h3><p>并不冲突， 甚至是可以混用的</p>
<h3 id="事务问题如何解决"><a href="#事务问题如何解决" class="headerlink" title="事务问题如何解决"></a>事务问题如何解决</h3><p>实体操作是可以兼容 JDBC 事务，在编排实体的应用层中加上 Spring 事务注解 @Transaction 即可</p>
<h3 id="重复查询的性能问题"><a href="#重复查询的性能问题" class="headerlink" title="重复查询的性能问题"></a>重复查询的性能问题</h3><p>如下，会执行三次数据库查询</p>
<pre class="line-numbers language-java"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>实际项目中，应使用带缓存的 ORM 框架（如 MyBatis），这样便可避免同一事务中重复查询带来的性能问题。否则应注意优化编码方式，如下</p>
<pre class="line-numbers language-java"><code class="language-java">UserDO data <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="复杂查询场景下的性能问题"><a href="#复杂查询场景下的性能问题" class="headerlink" title="复杂查询场景下的性能问题"></a>复杂查询场景下的性能问题</h3><p>DDD 要求将数据对象转换为内存中的实体对象后再进行业务操作，这注定了 DDD 不擅长批量查询以及联表查询等复杂的查询场景。业界采用的方案是 CQRS 模式，将查询操作从领域模型中分离出去。</p>
<p>要实现也很简单，有查询业务时，直接定义一个相应的 Service，在里面操作数据库完成查询即可。</p>
<p>更复杂一点，可以专门为查询操作开一个微服务，实现物理上的分离。</p>
<p>示例如下</p>
<p>不分离，会存在对 dto, vo 等对象的直接引用，导致领域模型被污染</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>UserLoginHistoryVO<span class="token operator">></span> <span class="token function">queryLoginHistory</span><span class="token punctuation">(</span>QueryDTO dto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">queryLoginHistory</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分离后，查询操作转移到专门的查询 Service 中</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserQueryService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>UserLoginHistoryVO<span class="token operator">></span> <span class="token function">queryLoginHistory</span><span class="token punctuation">(</span>QueryDTO dto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> dao<span class="token punctuation">.</span><span class="token function">queryLoginHistory</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/how_to_manage_a_complex_software_system.html" rel="prev" title="程序猿加班真的是常态吗? —— 浅谈如何治理一个复杂软件系统">
      <i class="fa fa-chevron-left"></i> 程序猿加班真的是常态吗? —— 浅谈如何治理一个复杂软件系统
    </a></div>
      <div class="post-nav-item">
    <a href="/thinking_about_cost_of_communication.html" rel="next" title="有关沟通成本的一点点思考">
      有关沟通成本的一点点思考 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DDD-编写的代码所属层次"><span class="nav-number">1.1.</span> <span class="nav-text">DDD 编写的代码所属层次</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#核心概念的落地"><span class="nav-number">2.</span> <span class="nav-text">核心概念的落地</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#实体"><span class="nav-number">2.1.</span> <span class="nav-text">实体</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实体与数据对象的关系"><span class="nav-number">2.1.1.</span> <span class="nav-text">实体与数据对象的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#引用"><span class="nav-number">2.1.2.</span> <span class="nav-text">引用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#硬关联"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">硬关联</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#软关联"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">软关联</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工厂"><span class="nav-number">2.2.</span> <span class="nav-text">工厂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实体仓储（Repository）-TODO"><span class="nav-number">2.3.</span> <span class="nav-text">实体仓储（Repository） TODO::</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#领域服务"><span class="nav-number">2.4.</span> <span class="nav-text">领域服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#示例"><span class="nav-number">2.4.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#领域事件"><span class="nav-number">2.5.</span> <span class="nav-text">领域事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DDD-设计"><span class="nav-number">2.6.</span> <span class="nav-text">DDD 设计</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它"><span class="nav-number">3.</span> <span class="nav-text">其它</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#与现有三层架构是否冲突"><span class="nav-number">3.1.</span> <span class="nav-text">与现有三层架构是否冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务问题如何解决"><span class="nav-number">3.2.</span> <span class="nav-text">事务问题如何解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重复查询的性能问题"><span class="nav-number">3.3.</span> <span class="nav-text">重复查询的性能问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复杂查询场景下的性能问题"><span class="nav-number">3.4.</span> <span class="nav-text">复杂查询场景下的性能问题</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="taccisum"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">taccisum</p>
  <div class="site-description" itemprop="description">el psy congroo.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/taccisum" title="GitHub → https://github.com/taccisum" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/taccisum@gmail.com" title="G-Mail → taccisum@gmail.com"><i class="fa fa-envelope fa-fw"></i>G-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">taccisum</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'q1GTC85aQcIvQIf3p9tWLTvW-gzGzoHsz',
      appKey     : 'OjWCd5UV1xcOyCEfsSzu9w7z',
      placeholder: "欢迎畅所欲言",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
