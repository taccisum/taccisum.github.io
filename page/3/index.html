<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5J42R3VH2D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5J42R3VH2D');
</script>

  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.7.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"taccisum.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="el psy congroo.">
<meta property="og:type" content="website">
<meta property="og:title" content="Taccisum&#39;s blog ğŸ˜‰">
<meta property="og:url" content="https://taccisum.github.io/page/3/index.html">
<meta property="og:site_name" content="Taccisum&#39;s blog ğŸ˜‰">
<meta property="og:description" content="el psy congroo.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Taccisum&#39;s blog ğŸ˜‰">
<meta name="twitter:description" content="el psy congroo.">

<link rel="canonical" href="https://taccisum.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Taccisum's blog ğŸ˜‰</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Taccisum's blog ğŸ˜‰</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/zuul_hystrix_default_timeout_config_invalid_reason_research.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/zuul_hystrix_default_timeout_config_invalid_reason_research.html" class="post-title-link" itemprop="url">zuulä¸­hystrixé»˜è®¤timeouté…ç½®å¤±æ•ˆçš„åŸå› </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-30 15:29:35" itemprop="dateCreated datePublished" datetime="2018-08-30T15:29:35+08:00">2018-08-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/è¸©å‘æ—¥è®°/" itemprop="url" rel="index"><span itemprop="name">è¸©å‘æ—¥è®°</span></a>
                </span>
            </span>

          
            <span id="/zuul_hystrix_default_timeout_config_invalid_reason_research.html" class="post-meta-item leancloud_visitors" data-flag-title="zuulä¸­hystrixé»˜è®¤timeouté…ç½®å¤±æ•ˆçš„åŸå› " title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/zuul_hystrix_default_timeout_config_invalid_reason_research.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/zuul_hystrix_default_timeout_config_invalid_reason_research.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ‰€å¤„ç¯å¢ƒ"><a href="#æ‰€å¤„ç¯å¢ƒ" class="headerlink" title="æ‰€å¤„ç¯å¢ƒ"></a>æ‰€å¤„ç¯å¢ƒ</h1><ul>
<li><code>spring boot</code>: 1.5.9.RELEASE</li>
<li><code>spring cloud</code>: Edgware.RELEASE</li>
</ul>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>æ ¹æ®netflix hystrixå®˜æ–¹çš„æè¿°ï¼Œå¯ä»¥é€šè¿‡<a href="https://github.com/Netflix/Hystrix/wiki/Configuration#execution.isolation.thread.timeoutInMilliseconds" target="_blank" rel="noopener"><code>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</code></a>è¿™ä¸ªå…¨å±€é…ç½®ä¸ºæ‰€æœ‰æœåŠ¡é…ç½®é»˜è®¤è¶…æ—¶æ—¶é—´ã€‚ç„¶è€Œåœ¨å®è·µä¸­å´å‘ç°è¯¥é…ç½®å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼ˆä¸€ç›´æ˜¯2000msï¼‰ï¼Œä½†é’ˆå¯¹å„æœåŠ¡è¿›è¡Œå•ç‹¬é…ç½®å´æ˜¯å¯ä»¥ç”Ÿæ•ˆçš„ã€‚</p>
<h1 id="é—®é¢˜å®šä½"><a href="#é—®é¢˜å®šä½" class="headerlink" title="é—®é¢˜å®šä½"></a>é—®é¢˜å®šä½</h1><p>ç»googleå‘ç°ï¼Œhystrixçš„timeoutæœºåˆ¶æ˜¯é€šè¿‡<code>HystrixTimer</code>æ¥å¤„ç†çš„ã€‚</p>
<p>HystrixTimeræ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨æ‰§è¡Œ<code>HystrixCommand</code>å‰é€šè¿‡è°ƒç”¨HystrixTimer.getInstance().addTimerListener()æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªå®šæ—¶çš„listenerï¼Œç„¶ååœ¨command on completedçš„æ—¶å€™ç§»é™¤å®ƒã€‚ç›¸å…³çš„ä»£ç å·²ç»ç”±netflixå®ç°äº†ï¼Œå¯ä»¥æŸ¥çœ‹æºç <a href="https://github.com/Netflix/Hystrix/blob/master/hystrix-core/src/main/java/com/netflix/hystrix/AbstractCommand.java#L1137" target="_blank" rel="noopener"><code>AbstractCommand.java</code></a></p>
<pre class="line-numbers language-java"><code class="language-java">TimerListener listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getIntervalTimeInMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> originalCommand<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">executionTimeoutInMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> Reference<span class="token operator">&lt;</span>TimerListener<span class="token operator">></span> tl <span class="token operator">=</span> HystrixTimer<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTimerListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// set externally so execute/queue can see this</span>
originalCommand<span class="token punctuation">.</span>timeoutTimer<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
* If this subscriber receives values it means the parent succeeded/completed
*/</span>
Subscriber<span class="token operator">&lt;</span>R<span class="token operator">></span> parent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscriber</span><span class="token operator">&lt;</span>R<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotTimedOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// stop timer and pass notification through</span>
            tl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            child<span class="token punctuation">.</span><span class="token function">onCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span>Throwable e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNotTimedOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// stop timer and pass notification through</span>
            tl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            child<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»ä»¥ä¸Šä»£ç å¯ä»¥å¾ˆå®¹æ˜“è¿½æº¯åˆ°hystrixè¶…æ—¶æ—¶é—´æ˜¯ä»originalCommand.properties(<code>HystrixCommandProperties</code>)è¿™ä¸ªå¯¹è±¡ä¸­è·å–çš„ï¼Œè€Œåœ¨spring cloudæä¾›çš„<code>AbstractRibbonCommand</code>ä¸­å­˜åœ¨ä»¥ä¸‹ä»£ç </p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">final</span> HystrixCommandProperties<span class="token punctuation">.</span>Setter setter <span class="token operator">=</span> HystrixCommandProperties<span class="token punctuation">.</span><span class="token function">Setter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withExecutionIsolationStrategy</span><span class="token punctuation">(</span>zuulProperties<span class="token punctuation">.</span><span class="token function">getRibbonIsolationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withExecutionTimeoutInMilliseconds</span><span class="token punctuation">(</span>
                RibbonClientConfiguration<span class="token punctuation">.</span>DEFAULT_CONNECT_TIMEOUT <span class="token operator">+</span> RibbonClientConfiguration<span class="token punctuation">.</span>DEFAULT_READ_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>å¯¼è‡´originalCommand.propertiesåœ¨æ„å»ºæ—¶å¯ä»¥è·å–åˆ°ä¸€ä¸ªexecutionTimeoutInMillisecondsçš„å®ä¾‹çº§é»˜è®¤å€¼ï¼Œä»è€Œè¦†ç›–æ‰äº†å…¨å±€çš„executionTimeoutInMillisecondsé…ç½®ï¼Œä½†å®ä¾‹çº§çš„é…ç½®å¹¶ä¸å—å½±å“ï¼Œå› ä¸ºhystrix propertyä¼˜å…ˆçº§ä¸ºï¼š</strong>  </p>
<ol>
<li>Global default from code</li>
<li>Dynamic global default property</li>
<li>Instance default from code</li>
<li>Dynamic instance property</li>
</ol>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><ol>
<li><p>æ”¹å†™HttpClientRibbonCommandçš„å®ç°<br>//todo:: å¾…è¡¥å……</p>
</li>
<li><p>å‡çº§spring cloudç‰ˆæœ¬åˆ°Edgware.SR1ä»¥ä¸Š<br>Spring cloudåœ¨<code>Edgware.SR1</code>ç‰ˆæœ¬ä¸­å·²ç»è§£å†³äº†æ­¤é—®é¢˜(<a href="https://github.com/spring-cloud/spring-cloud-netflix/pull/2633" target="_blank" rel="noopener">issue2633</a>)ï¼Œå¦‚æœæœ‰æ¡ä»¶å¯ä»¥ç›´æ¥é€šè¿‡å‡çº§ç‰ˆæœ¬æ¥è§£å†³æ­¤é—®é¢˜ã€‚</p>
</li>
</ol>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul>
<li><a href="https://github.com/Netflix/Hystrix/wiki/Configuration" target="_blank" rel="noopener">Hystrix Configurations</a></li>
<li><a href="https://segmentfault.com/a/1190000015393836" target="_blank" rel="noopener">èŠèŠhystrixçš„timeoutå¤„ç† - segmentfault</a></li>
<li><a href="https://segmentfault.com/a/1190000012439580" target="_blank" rel="noopener">Hystrixå·¥ä½œåŸç†</a></li>
<li><a href="https://www.jianshu.com/p/6e2f11821c77" target="_blank" rel="noopener">ribbonè®¾ç½®urlçº§åˆ«çš„è¶…æ—¶æ—¶é—´</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/openfeign_research_and_application.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/openfeign_research_and_application.html" class="post-title-link" itemprop="url">å£°æ˜å¼httpå®¢æˆ·ç«¯openfeignçš„ç ”ç©¶ä¸åº”ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-21 05:54:42" itemprop="dateCreated datePublished" datetime="2018-06-21T05:54:42+08:00">2018-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/spring-cloud/" itemprop="url" rel="index"><span itemprop="name">spring cloud</span></a>
                </span>
            </span>

          
            <span id="/openfeign_research_and_application.html" class="post-meta-item leancloud_visitors" data-flag-title="å£°æ˜å¼httpå®¢æˆ·ç«¯openfeignçš„ç ”ç©¶ä¸åº”ç”¨" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/openfeign_research_and_application.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/openfeign_research_and_application.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><h2 id="openfeign"><a href="#openfeign" class="headerlink" title="openfeign"></a>openfeign</h2><p>openfeignï¼Œç®€ç§°feignï¼Œæ˜¯netflixå¼€æºçš„æŠ€æœ¯æ ˆä¹‹ä¸€ã€‚<br>feignçš„ä¸»æ—¨æ˜¯ä½¿å¾—ç¼–å†™java httpå®¢æˆ·ç«¯æ›´å®¹æ˜“ã€‚ä¸ºäº†è´¯å½»è¿™ä¸ªç†å¿µï¼Œfeigné‡‡ç”¨äº†é€šè¿‡å¤„ç†æ³¨è§£æ¥è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚çš„æ–¹å¼ï¼ˆå®˜æ–¹ç§°å‘¼ä¸º<code>å£°æ˜å¼</code>ã€<code>æ¨¡æ¿åŒ–</code>ï¼‰ã€‚å› æ­¤ï¼ŒåŸºäºfeignç¼–å†™çš„httpå®¢æˆ·ç«¯ç”»é£çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">Bank</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@RequestLine</span><span class="token punctuation">(</span><span class="token string">"POST /account/{id}"</span><span class="token punctuation">)</span>
  Account <span class="token function">getAccountInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> String id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åé€šè¿‡ä¸€ç³»åˆ—æ“ä½œå¯ä»¥ä¸ºBankæ¥å£åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„å®ç°ã€‚é€šè¿‡è¿™ä¸ªå®ç°æˆ‘ä»¬å°±å¯ä»¥åœ¨javaä¸­åƒè°ƒç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ä¸€æ ·å®Œæˆä¸€æ¬¡httpè¯·æ±‚ï¼Œå¤§å¤§å‡å°‘äº†ç¼–ç æˆæœ¬ï¼ŒåŒæ—¶æé«˜äº†ä»£ç å¯è¯»æ€§ã€‚</p>
<h2 id="spring-cloud-openfeign"><a href="#spring-cloud-openfeign" class="headerlink" title="spring-cloud-openfeign"></a>spring-cloud-openfeign</h2><p>spring-cloud-feignåŸºäºè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼ˆautoconfigurationï¼‰ï¼Œä¸ºspring bootåº”ç”¨æä¾›openfiegnçš„é›†æˆï¼š</p>
<ul>
<li>æ”¯æŒé€šè¿‡<code>JAX-RS</code>æˆ–<code>Spring MVC annotations</code>æ¥æ„å»ºfeign client</li>
<li>è‡ªåŠ¨ä½¿ç”¨Spring MVCçš„<code>HttpMessageConverters</code>æ¥å®Œæˆåºåˆ—åŒ–ååºåˆ—åŒ–</li>
<li>é›†æˆäº†<code>ribbon</code>å’Œ<code>hystrix</code>ï¼Œåªè¦åœ¨é¡¹ç›®ä¸­å¼•å…¥ç›¸å…³çš„ä¾èµ–å³å¯ç«‹å³ä½¿ç”¨</li>
<li>æ— éœ€ä»»ä½•é…ç½®ï¼Œå¼€ç®±å³ç”¨ï¼Œç§‰æ‰¿äº†spring-bootä¸€è´¯çš„ä½œé£ã€‚</li>
</ul>
<blockquote>
<p><a href="https://github.com/spring-cloud/spring-cloud-openfeign/blob/master/docs/src/main/asciidoc/spring-cloud-openfeign.adoc" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£å‚è€ƒ</a></p>
</blockquote>
<h1 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h1><h2 id="å¤„ç†å“åº”æ•°æ®çš„é€šç”¨éƒ¨åˆ†"><a href="#å¤„ç†å“åº”æ•°æ®çš„é€šç”¨éƒ¨åˆ†" class="headerlink" title="å¤„ç†å“åº”æ•°æ®çš„é€šç”¨éƒ¨åˆ†"></a>å¤„ç†å“åº”æ•°æ®çš„é€šç”¨éƒ¨åˆ†</h2><p>apiå“åº”æ•°æ®æ ¼å¼ï¼Œä¸€èˆ¬è€Œè¨€é™¤å®é™…çš„ä¸šåŠ¡æ•°æ®å¤–æ˜¯å›ºå®šçš„æ ¼å¼ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¯¹æ­¤æ¬¡è¯·æ±‚çš„å¤„ç†ä¿¡æ¯æè¿°ã€‚å¯¹äºè¿™éƒ¨åˆ†æ•°æ®ï¼Œåº”ç”±feignè¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>feignclientæ˜¯é€šè¿‡Decoderæ¥å¯¹è¯·æ±‚å“åº”è¿›è¡Œå¤„ç†çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„Decoderæ¥å¤„ç†å“åº”æ•°æ®çš„é€šç”¨éƒ¨åˆ†ã€‚</p>
<p>ä¾‹å¦‚å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>UnwrapRestfulApiResponseSpringDecoder</code>æ¥å¯¹<code>RestfulApiResponse</code>è¿›è¡Œè‡ªåŠ¨æ‹†åŒ…æ“ä½œï¼Œå¹¶é€šè¿‡<code>@FeignClient</code>çš„<code>configuration</code>å±æ€§é…ç½®å…¶ä½¿ç”¨çš„Decoderã€‚</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> AuthCenter<span class="token punctuation">.</span>SERVICE_NAME<span class="token punctuation">,</span> path <span class="token operator">=</span> RMIPath<span class="token punctuation">.</span>USER<span class="token punctuation">,</span> configuration <span class="token operator">=</span> TenantUserClient<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TenantUserClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Configuration</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Autowired</span>
        <span class="token keyword">private</span> ObjectFactory<span class="token operator">&lt;</span>HttpMessageConverters<span class="token operator">></span> messageConverters<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token keyword">public</span> Decoder <span class="token function">feignDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntityDecoder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UnwrapRestfulApiResponseSpringDecoder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageConverters<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æœ¬åœ°è°ƒç”¨éœ€è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒå¯¼è‡´æœåŠ¡ä¸å¯ç”¨çš„é—®é¢˜"><a href="#æœ¬åœ°è°ƒç”¨éœ€è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒå¯¼è‡´æœåŠ¡ä¸å¯ç”¨çš„é—®é¢˜" class="headerlink" title="æœ¬åœ°è°ƒç”¨éœ€è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒå¯¼è‡´æœåŠ¡ä¸å¯ç”¨çš„é—®é¢˜"></a>æœ¬åœ°è°ƒç”¨éœ€è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒå¯¼è‡´æœåŠ¡ä¸å¯ç”¨çš„é—®é¢˜</h2><p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¼šå‡ºç°éœ€è¦åœ¨æœ¬åœ°è°ƒç”¨è¿œç¨‹æœåŠ¡æ¥è¿›è¡Œè°ƒè¯•çš„æƒ…å†µï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦å°†æœ¬åœ°çš„åº”ç”¨æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚è€Œä¸€æ—¦è¿™æ ·åšï¼Œä¼šå¯¼è‡´è¯¥æœåŠ¡å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼ˆä¸€ä¸ªè¿œç¨‹ä¸€ä¸ªæœ¬åœ°ï¼‰ï¼Œä»è€Œå¯¼è‡´ä¾èµ–è¯¥æœåŠ¡çš„åº”ç”¨è½¯è´Ÿè½½å‡è¡¡è´Ÿè½½åˆ°æœ¬åœ°èŠ‚ç‚¹æ—¶ä¼šå¤±è´¥ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h4 id="1-ä¸é€šè¿‡æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ï¼Œä½¿ç”¨ç›´æ¥æŒ‡å®šurlçš„æ–¹å¼è°ƒç”¨ï¼ˆâœ˜ä¸æ¨èï¼‰"><a href="#1-ä¸é€šè¿‡æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ï¼Œä½¿ç”¨ç›´æ¥æŒ‡å®šurlçš„æ–¹å¼è°ƒç”¨ï¼ˆâœ˜ä¸æ¨èï¼‰" class="headerlink" title="1. ä¸é€šè¿‡æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ï¼Œä½¿ç”¨ç›´æ¥æŒ‡å®šurlçš„æ–¹å¼è°ƒç”¨ï¼ˆâœ˜ä¸æ¨èï¼‰"></a>1. ä¸é€šè¿‡æ³¨å†Œä¸­å¿ƒè·å–ä¿¡æ¯ï¼Œä½¿ç”¨ç›´æ¥æŒ‡å®šurlçš„æ–¹å¼è°ƒç”¨ï¼ˆâœ˜ä¸æ¨èï¼‰</h4><p><strong>å‚è€ƒä»£ç </strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"sysinfo-service"</span> <span class="token punctuation">,</span>url <span class="token operator">=</span> <span class="token string">"http://49.4.7.72"</span><span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysinfoClient</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ­¤æ–¹æ¡ˆä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨ï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p>
<ol>
<li>åœ¨åº”ç”¨å®é™…ä¸Šçº¿æ—¶éœ€è¦å°†è°ƒç”¨æ–¹å¼ä¿®æ”¹ä¸ºé€šè¿‡æ³¨å†Œä¸­å¿ƒè°ƒç”¨ï¼Œå¦åˆ™clientå°†æ— æ³•è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå› æ­¤éœ€è¦é¢‘ç¹æ”¹åŠ¨ä»£ç </li>
<li>åœ¨ç‰¹å®šç¯å¢ƒä¸‹ï¼Œå³ä½¿å¿˜è®°åˆ‡æ¢è°ƒç”¨æ–¹å¼æœ‰æ—¶ä¹Ÿä¸å½±å“clientçš„ä½¿ç”¨ï¼Œä¼šå°†é—®é¢˜éšè—ï¼ŒåŸ‹ä¸‹éšæ‚£</li>
<li>å¹¶æ²¡æœ‰ä¸å…¶å®ƒæœåŠ¡çœŸæ­£åœ°è§£è€¦ï¼Œä¸€æ—¦ä¾èµ–çš„æœåŠ¡æ•…éšœå°±ä¼šå¯¼è‡´æœ¬åœ°å¼€å‘æ— æ³•è¿›è¡Œ</li>
</ol>
<p>ç”±äºå­˜åœ¨ä¸Šè¿°ç¼ºç‚¹ï¼Œç°ä¸€èˆ¬<strong>ä¸æ¨è</strong>ä½¿ç”¨è¯¥æ–¹æ¡ˆã€‚</p>
<h4 id="2-ä½¿ç”¨æ‰“æ¡©çš„æ–¹å¼ä¸è¿œç¨‹æœåŠ¡è§£è€¦ï¼ˆâœ”æ¨èï¼‰"><a href="#2-ä½¿ç”¨æ‰“æ¡©çš„æ–¹å¼ä¸è¿œç¨‹æœåŠ¡è§£è€¦ï¼ˆâœ”æ¨èï¼‰" class="headerlink" title="2. ä½¿ç”¨æ‰“æ¡©çš„æ–¹å¼ä¸è¿œç¨‹æœåŠ¡è§£è€¦ï¼ˆâœ”æ¨èï¼‰"></a>2. ä½¿ç”¨æ‰“æ¡©çš„æ–¹å¼ä¸è¿œç¨‹æœåŠ¡è§£è€¦ï¼ˆâœ”æ¨èï¼‰</h4><p>å¤§è‡´æ€è·¯ä¸ºï¼Œé€šè¿‡Springçš„<code>@Profile</code>æ³¨è§£ï¼Œåœ¨ä¸åŒçš„ç¯å¢ƒä¸ºåº”ç”¨æ³¨å†Œä¸åŒçš„client beanï¼ˆä¾‹å¦‚åœ¨æœ¬åœ°ç¯å¢ƒä½¿ç”¨Hard Code beanï¼Œè€Œåœ¨éæœ¬åœ°ç¯å¢ƒåˆ™ä½¿ç”¨è¿œç¨‹è°ƒç”¨çš„client beanï¼‰ã€‚</p>
<p><strong>å‚è€ƒä»£ç </strong><br><strong>ClientConfiguration.java</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@EnableAuthClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.cheegu.icm.biz.foo.client"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>SpringProfiles<span class="token punctuation">.</span>DEV<span class="token punctuation">,</span> SpringProfiles<span class="token punctuation">.</span>TEST<span class="token punctuation">,</span> SpringProfiles<span class="token punctuation">.</span>PROD<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>MockClientConfiguration.java</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span>SpringProfiles<span class="token punctuation">.</span>LOCAL<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockClientConfiguration</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> SysinfoClient <span class="token function">sysinfoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SysinfoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> UserInfoDto <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserInfoDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> TableData<span class="token operator">&lt;</span>UserRowDto<span class="token operator">></span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> TableData<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> TenantUserClient <span class="token function">tenantUserClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TenantUserClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> List<span class="token operator">&lt;</span>ResourceInfoDto<span class="token operator">></span> <span class="token function">listMyAlResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="å¦‚ä½•åœ¨è°ƒç”¨æ—¶å¸¦ä¸Šè¯·æ±‚å¤´"><a href="#å¦‚ä½•åœ¨è°ƒç”¨æ—¶å¸¦ä¸Šè¯·æ±‚å¤´" class="headerlink" title="å¦‚ä½•åœ¨è°ƒç”¨æ—¶å¸¦ä¸Šè¯·æ±‚å¤´"></a>å¦‚ä½•åœ¨è°ƒç”¨æ—¶å¸¦ä¸Šè¯·æ±‚å¤´</h2><p>åœ¨ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨æ—¶ï¼Œæœ‰æ—¶ä¼šéœ€è¦å¸¦ä¸ŠæŸäº›è¯·æ±‚å¤´ï¼ˆä¾‹å¦‚è®¤è¯tokenï¼‰ï¼Œä½†åˆä¸å¸Œæœ›åœ¨ä»£ç ä¸­æ‰‹åŠ¨å»åšè¿™äº›æ“ä½œã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¯ä»¥é€šè¿‡å®ç°feignæä¾›çš„<code>RequestInterceptor</code>æ¥å£æ¥å¯¹è¯·æ±‚è¿›è¡Œåˆ‡é¢å¤„ç†ã€‚è¿™æ ·æ¯æ¬¡é€šè¿‡clientå‘èµ·è¯·æ±‚æ—¶éƒ½ä¼šç”±feign interceptorè¿›è¡Œæ‹¦æˆªï¼Œä¸ºè¯·æ±‚æ·»åŠ headersã€‚</p>
<p><strong>å‚è€ƒä»£ç </strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">EnvironmentAware</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> Environment environment<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> AuthorizationInfoForwardingInterceptor <span class="token function">authorizationInfoForwardingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//è¿™ä¸ªinterceptorä¼šä¸ºè¯·æ±‚è‡ªåŠ¨å¸¦ä¸Šè®¤è¯token</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AuthorizationInfoForwardingInterceptor</span><span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"spring.application.name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnvironment</span><span class="token punctuation">(</span>Environment environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> environment<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æŒ‡å®šäº†getæ–¹æ³•ï¼Œä½†feignä»ç„¶ä½¿ç”¨äº†postæ–¹æ³•è¿›è¡Œè¯·æ±‚"><a href="#æŒ‡å®šäº†getæ–¹æ³•ï¼Œä½†feignä»ç„¶ä½¿ç”¨äº†postæ–¹æ³•è¿›è¡Œè¯·æ±‚" class="headerlink" title="æŒ‡å®šäº†getæ–¹æ³•ï¼Œä½†feignä»ç„¶ä½¿ç”¨äº†postæ–¹æ³•è¿›è¡Œè¯·æ±‚"></a>æŒ‡å®šäº†getæ–¹æ³•ï¼Œä½†feignä»ç„¶ä½¿ç”¨äº†postæ–¹æ³•è¿›è¡Œè¯·æ±‚</h2><p>å¦‚ä¸‹ä»£ç æ‰€ç¤º</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"microservice-provider-user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserFeignClient</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/get"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
  <span class="token keyword">public</span> User <span class="token function">get0</span><span class="token punctuation">(</span>User user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡<code>@RequestMapping</code>çš„methodå±æ€§æŒ‡å®šäº†è¯·æ±‚æ–¹æ³•ä¸ºGETï¼Œä½†å®é™…è¿è¡Œä¼šå‘ç°feignä»ç„¶ä½¿ç”¨äº†POSTæ–¹æ³•è¿›è¡Œäº†è°ƒç”¨ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ-3"><a href="#è§£å†³æ–¹æ¡ˆ-3" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>è¿™ç§å†™æ³•å¹¶ä¸æ­£ç¡®ï¼Œæ­£ç¡®å†™æ³•æœ‰äºŒï¼š</p>
<h4 id="1-é€šè¿‡-RequestParamæŒ‡å®šurlå‚æ•°å"><a href="#1-é€šè¿‡-RequestParamæŒ‡å®šurlå‚æ•°å" class="headerlink" title="1. é€šè¿‡@RequestParamæŒ‡å®šurlå‚æ•°å"></a>1. é€šè¿‡@RequestParamæŒ‡å®šurlå‚æ•°å</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"microservice-provider-user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserFeignClient</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/get"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
  <span class="token keyword">public</span> User <span class="token function">get1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> String username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-å½“ç›®æ ‡urlå‚æ•°è¾ƒå¤šæ—¶ï¼Œå¯ä½¿ç”¨mapæ¥æ„å»º"><a href="#2-å½“ç›®æ ‡urlå‚æ•°è¾ƒå¤šæ—¶ï¼Œå¯ä½¿ç”¨mapæ¥æ„å»º" class="headerlink" title="2. å½“ç›®æ ‡urlå‚æ•°è¾ƒå¤šæ—¶ï¼Œå¯ä½¿ç”¨mapæ¥æ„å»º"></a>2. å½“ç›®æ ‡urlå‚æ•°è¾ƒå¤šæ—¶ï¼Œå¯ä½¿ç”¨mapæ¥æ„å»º</h4><pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"microservice-provider-user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserFeignClient</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/get"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
  <span class="token keyword">public</span> User <span class="token function">get2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ä½¿ç”¨MultipartFileç±»å‹ä½œä¸ºè¯·æ±‚å‚æ•°"><a href="#ä½¿ç”¨MultipartFileç±»å‹ä½œä¸ºè¯·æ±‚å‚æ•°" class="headerlink" title="ä½¿ç”¨MultipartFileç±»å‹ä½œä¸ºè¯·æ±‚å‚æ•°"></a>ä½¿ç”¨MultipartFileç±»å‹ä½œä¸ºè¯·æ±‚å‚æ•°</h2><p>æœ‰æ—¶å¯¹å¤–æä¾›çš„æ¥å£è°ƒç”¨å¯èƒ½éœ€è¦ä¼ é€æ–‡ä»¶ï¼Œæ­¤æ—¶éœ€è¦å¯¹<code>MultipartFile</code>ç±»å‹çš„å‚æ•°è¿›è¡Œå¤„ç†</p>
<h3 id="è§£å†³æ–¹æ¡ˆ-4"><a href="#è§£å†³æ–¹æ¡ˆ-4" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p><strong>å¾…è¡¥å……</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/outbound_rule_invalid_cause_by_urlrewritefilter_and_shirofilter.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/outbound_rule_invalid_cause_by_urlrewritefilter_and_shirofilter.html" class="post-title-link" itemprop="url">åŒæ—¶é…ç½®UrlRewriteFilterä¸ShiroFilterå¯¼è‡´outbound ruleå¤±æ•ˆçš„é—®é¢˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-12-21 16:10:51" itemprop="dateCreated datePublished" datetime="2017-12-21T16:10:51+08:00">2017-12-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/è¸©å‘æ—¥è®°/" itemprop="url" rel="index"><span itemprop="name">è¸©å‘æ—¥è®°</span></a>
                </span>
            </span>

          
            <span id="/outbound_rule_invalid_cause_by_urlrewritefilter_and_shirofilter.html" class="post-meta-item leancloud_visitors" data-flag-title="åŒæ—¶é…ç½®UrlRewriteFilterä¸ShiroFilterå¯¼è‡´outbound ruleå¤±æ•ˆçš„é—®é¢˜" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/outbound_rule_invalid_cause_by_urlrewritefilter_and_shirofilter.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/outbound_rule_invalid_cause_by_urlrewritefilter_and_shirofilter.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="é¡¹ç›®ç¯å¢ƒ"><a href="#é¡¹ç›®ç¯å¢ƒ" class="headerlink" title="é¡¹ç›®ç¯å¢ƒ"></a>é¡¹ç›®ç¯å¢ƒ</h2><p>Spring Boot1.5.4 + Shiro1.4.0 + UrlRewriteFilter4.0.4</p>
<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­åŒæ—¶ç”¨åˆ°<a href="http://shiro.apache.org/" target="_blank" rel="noopener">Shiro</a>å’Œ<a href="http://www.tuckey.org/urlrewrite/" target="_blank" rel="noopener">UrlRewriteFilter</a>ã€‚ç”±äºåœ¨webç¯å¢ƒä¸‹ä¸¤è€…éƒ½æ˜¯é€šè¿‡é…ç½®filteræ¥å®ç°åŠŸèƒ½çš„ï¼Œå› æ­¤å¯¼è‡´å‡ºç°äº†å†²çªâ€”â€”UrlRewriteFilterçš„outbound ruleæ— æ³•æ­£å¸¸å·¥ä½œã€‚å…·ä½“è¡¨ç°ä¸ºï¼š</p>
<p>åœ¨urlrewrite.xmlä¸­é…ç½®äº†</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>urlrewrite</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outbound-rule</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>/in-rewrite\?type=(\w+)$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>/in/$1.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outbound-rule</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>urlrewrite</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨javaä»£ç ä¸­å®šä¹‰action</p>
<pre class="line-numbers language-java"><code class="language-java">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"out-rewrite"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> String <span class="token function">out</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">encodeURL</span><span class="token punctuation">(</span><span class="token string">"localhost:8080/in-rewrite?type=233"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//will be rewrite to 'localhost:8080/in/233.html'</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­£å¸¸æ¥è¯´ï¼Œè®¿é—®è¿™ä¸ªapiåº”è¯¥è¿”å›â€localhost:8080/in/233.htmlâ€æ‰å¯¹ï¼Œä½†å´è¿”å›äº†æœªè½¬æ¢å‰çš„urlï¼Œå³â€localhost:8080/in-rewrite?type=233â€ã€‚</p>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>åœ¨è°ƒè¯•æºç çš„æ—¶å€™å‘ç°ï¼ŒåŒæ—¶é…ç½®äº†ShiroFilterå’ŒUrlRewriteFilteræ—¶ï¼Œresponseçš„ç±»å‹æ˜¯<code>ShiroHttpServletResponse</code>ï¼Œæ­¤æ—¶outbound ruleæ˜¯ä¸èµ·ä½œç”¨çš„ã€‚è€ŒæŠŠShiroFilterçš„é…ç½®å»æ‰ï¼Œåªç•™ä¸‹UrlRewriteFilteræ—¶ï¼Œresponseçš„ç±»å‹åˆ™æ˜¯<code>UrlRewriteWrappedResponse</code>ï¼Œè€Œæ­¤æ—¶outbound ruleæ˜¯èµ·ä½œç”¨çš„ã€‚æ˜¾ç„¶ï¼Œä¸¤è€…åœ¨filteré‡Œé¢éƒ½å¯¹responseè¿›è¡Œäº†é‡æ–°åŒ…è£…ï¼Œè€ŒShiroFilteræ‰§è¡Œåœ¨åï¼Œå¯¼è‡´å‰è€…çš„éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆã€‚</p>
<p>å†æŸ¥çœ‹ä¸Šé¢ä¸¤ä¸ªresponseåŒ…è£…ç±»çš„æºç ï¼š</p>
<p><strong>UrlRewriteWrappedResponse.java</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> String <span class="token function">encodeURL</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        RewrittenOutboundUrl rou <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processPreEncodeURL</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rou <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">encodeURL</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>rou<span class="token punctuation">.</span><span class="token function">isEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                rou<span class="token punctuation">.</span><span class="token function">setTarget</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">encodeURL</span><span class="token punctuation">(</span>rou<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processPostEncodeURL</span><span class="token punctuation">(</span>rou<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ShiroHttpServletResponse.java</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> String <span class="token function">encodeURL</span><span class="token punctuation">(</span>String url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String absolute <span class="token operator">=</span> <span class="token function">toAbsolute</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEncodeable</span><span class="token punctuation">(</span>absolute<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// W3c spec clearly said</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                url <span class="token operator">=</span> absolute<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token function">toEncoded</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> url<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‘ç°ä¸¤è€…å‡å¯¹<code>encodeUrl</code>ã€<code>encodeRedirectUrl</code>ç­‰å››ä¸ªæ–¹æ³•è¿›è¡Œäº†æ”¹å†™ã€‚Shiroçš„åŒ…è£…ç±»æ‰§è¡Œåœ¨åï¼Œå¯¼è‡´<code>UrlRewriteWrappedResponse</code>çš„ç›¸å…³ä»£ç æ²¡æœ‰è¢«æ‰§è¡Œã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="é‡æ’Filterçš„æ‰§è¡Œé¡ºåº"><a href="#é‡æ’Filterçš„æ‰§è¡Œé¡ºåº" class="headerlink" title="é‡æ’Filterçš„æ‰§è¡Œé¡ºåº"></a>é‡æ’Filterçš„æ‰§è¡Œé¡ºåº</h3><p>è®©<code>UrlRewriteWrappedResponse</code>çš„åŒ…è£…è¿‡ç¨‹æ‰§è¡Œåœ¨åï¼Œé¿å…encodeUrlæ–¹æ³•è¢«æ”¹å†™ã€‚</p>
<p>æ˜¾ç„¶è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„åŠæ³•ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¼è‡´<code>ShiroHttpServletResponse</code>çš„æ–¹æ³•è¢«æ”¹å†™ï¼Œå¯èƒ½å¼•å‡ºå…¶å®ƒæœªçŸ¥é—®é¢˜ï¼Œæ— å¼‚äºæ‹†ä¸œå¢™è¡¥è¥¿å¢™</li>
<li>å¯¼è‡´ShiroFilteræ‰§è¡Œåœ¨å‰ï¼Œå¯èƒ½å¯¼è‡´ä¸€äº›è®¿é—®çš„urlè¿˜æœªè¢«é‡å†™ï¼Œè¿™æ¬¡è®¿é—®å°±è¢«Shiroæ‹¦æˆªäº†</li>
</ol>
<h3 id="è‡ªå·±å®ç°encodeUrlçš„é€»è¾‘"><a href="#è‡ªå·±å®ç°encodeUrlçš„é€»è¾‘" class="headerlink" title="è‡ªå·±å®ç°encodeUrlçš„é€»è¾‘"></a>è‡ªå·±å®ç°encodeUrlçš„é€»è¾‘</h3><p>è®©<code>ShiroHttpServletResponse</code>æ‰§è¡Œencodeå‰å…ˆæ‰§è¡Œ<code>UrlRewriteWrappedResponse</code>çš„encodeä»£ç ã€‚</p>
<ol>
<li><p>æ”¹å†™<code>ShiroHttpServletResponse</code>ï¼Œé‡å†™å…¶encodeé€»è¾‘</p>
<pre class="line-numbers language-java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomShiroHttpServletResponse</span> <span class="token keyword">extends</span> <span class="token class-name">ShiroHttpServletResponse</span> <span class="token punctuation">{</span>
     <span class="token keyword">private</span> HttpServletResponse wrapped<span class="token punctuation">;</span>

     <span class="token keyword">public</span> <span class="token function">CustomShiroHttpServletResponse</span><span class="token punctuation">(</span>HttpServletResponse wrapped<span class="token punctuation">,</span> ServletContext context<span class="token punctuation">,</span> ShiroHttpServletRequest request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">super</span><span class="token punctuation">(</span>wrapped<span class="token punctuation">,</span> context<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>wrapped <span class="token operator">=</span> wrapped<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> String <span class="token function">encodeRedirectURL</span><span class="token punctuation">(</span>String url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">encodeRedirectURL</span><span class="token punctuation">(</span>wrapped<span class="token punctuation">.</span><span class="token function">encodeRedirectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> String <span class="token function">encodeRedirectUrl</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">encodeRedirectUrl</span><span class="token punctuation">(</span>wrapped<span class="token punctuation">.</span><span class="token function">encodeRedirectUrl</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> String <span class="token function">encodeURL</span><span class="token punctuation">(</span>String url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">encodeURL</span><span class="token punctuation">(</span>wrapped<span class="token punctuation">.</span><span class="token function">encodeURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> String <span class="token function">encodeUrl</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">encodeUrl</span><span class="token punctuation">(</span>wrapped<span class="token punctuation">.</span><span class="token function">encodeUrl</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>æ”¹å†™<code>ShiroFilter</code>ï¼Œä½¿ç”¨<code>CustomShiroHttpServletResponse</code>ä»£æ›¿<code>ShiroHttpServletResponse</code></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomSpringShiroFilter</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractShiroFilter</span> <span class="token punctuation">{</span>
 <span class="token keyword">protected</span> <span class="token function">CustomSpringShiroFilter</span><span class="token punctuation">(</span>WebSecurityManager webSecurityManager<span class="token punctuation">,</span> FilterChainResolver resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true">//è¿™æ®µä»£ç æ˜¯copyäº†ShiroFilterFactoryBean$SpringShiroFilterçš„æ„é€ æ–¹æ³•ä¸­çš„ä»£ç </span>
     <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>webSecurityManager <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"WebSecurityManager property cannot be null."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token function">setSecurityManager</span><span class="token punctuation">(</span>webSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>resolver <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">setFilterChainResolver</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> ServletResponse <span class="token function">wrapServletResponse</span><span class="token punctuation">(</span>HttpServletResponse orig<span class="token punctuation">,</span> ShiroHttpServletRequest request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true">//ä½¿ç”¨CustomShiroHttpServletResponseä»£æ›¿åŸæœ‰çš„Response Wrapper</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomShiroHttpServletResponse</span><span class="token punctuation">(</span>orig<span class="token punctuation">,</span> <span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>ç„¶åæ”¹å†™<code>ShiroFilterFactoryBean</code>çš„createInstanceæ–¹æ³•ï¼Œä½¿ç”¨<code>CustomSpringShiroFilter</code>ï¼Œä»£æ›¿åŸæ¥çš„Filter</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomShiroFilterFactoryBean</span> <span class="token keyword">extends</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">transient</span> <span class="token keyword">final</span> Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>ShiroFilterFactoryBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> AbstractShiroFilter <span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true">//è¿™éƒ¨åˆ†ä»£ç ä¸çˆ¶ç±»ç›¸åŒ</span>
     log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Creating Shiro Filter instance."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     SecurityManager securityManager <span class="token operator">=</span> <span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>securityManager <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         String msg <span class="token operator">=</span> <span class="token string">"SecurityManager property must be set."</span><span class="token punctuation">;</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanInitializationException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>securityManager <span class="token keyword">instanceof</span> <span class="token class-name">WebSecurityManager</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         String msg <span class="token operator">=</span> <span class="token string">"The security manager does not implement the WebSecurityManager interface."</span><span class="token punctuation">;</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanInitializationException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     FilterChainManager manager <span class="token operator">=</span> <span class="token function">createFilterChainManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     PathMatchingFilterChainResolver chainResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PathMatchingFilterChainResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     chainResolver<span class="token punctuation">.</span><span class="token function">setFilterChainManager</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment" spellcheck="true">//ä½¿ç”¨CustomSpringShiroFilterä»£æ›¿SpringShiroFilter</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomSpringShiroFilter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>WebSecurityManager<span class="token punctuation">)</span> securityManager<span class="token punctuation">,</span> chainResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>é‡å¯é¡¹ç›®ï¼Œè®¿é—®â€/out-rewriteâ€ï¼Œç»“æœå¦‚ä¸‹<br><img src="/images/20171221/outbound.png" alt="outbound rule"></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/instantiationexception_on_mybatistest.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/instantiationexception_on_mybatistest.html" class="post-title-link" itemprop="url">åœ¨@MybatisTestä¸­ä½¿ç”¨é€šç”¨Mapperå‡ºç°InstantiationExceptionçš„é—®é¢˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-11-15 11:42:36" itemprop="dateCreated datePublished" datetime="2017-11-15T11:42:36+08:00">2017-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/è¸©å‘æ—¥è®°/" itemprop="url" rel="index"><span itemprop="name">è¸©å‘æ—¥è®°</span></a>
                </span>
            </span>

          
            <span id="/instantiationexception_on_mybatistest.html" class="post-meta-item leancloud_visitors" data-flag-title="åœ¨@MybatisTestä¸­ä½¿ç”¨é€šç”¨Mapperå‡ºç°InstantiationExceptionçš„é—®é¢˜" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/instantiationexception_on_mybatistest.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/instantiationexception_on_mybatistest.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨Spring Bootç¯å¢ƒä¸­ä½¿ç”¨<a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-test-autoconfigure/" target="_blank" rel="noopener">@MybatisTest</a>æ³¨è§£é’ˆå¯¹Mapperå†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œç”±äºåŒæ—¶å¼•å…¥äº†<a href="https://github.com/abel533/Mapper" target="_blank" rel="noopener">é€šç”¨Mapper</a>ï¼Œåœ¨å•å…ƒæµ‹è¯•ä¸­è°ƒç”¨é€šç”¨Mapperçš„æ–¹æ³•è¿›è¡ŒCRUDæ—¶ä¼šå‡ºç°<code>InstantiationException</code>å¼‚å¸¸</p>
<pre class="line-numbers language-java"><code class="language-java">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>MyBatisSystemException<span class="token operator">:</span> nested exception is org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>BuilderException<span class="token operator">:</span> Error invoking SqlProvider <span class="token function">method</span> <span class="token punctuation">(</span>tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>base<span class="token punctuation">.</span>BaseSelectProvider<span class="token punctuation">.</span>dynamicSQL<span class="token punctuation">)</span><span class="token punctuation">.</span>  Cause<span class="token operator">:</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InstantiationException<span class="token operator">:</span> tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>base<span class="token punctuation">.</span>BaseSelectProvider

    at org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>MyBatisExceptionTranslator<span class="token punctuation">.</span><span class="token function">translateExceptionIfPossible</span><span class="token punctuation">(</span>MyBatisExceptionTranslator<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">77</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>SqlSessionTemplate$SqlSessionInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>SqlSessionTemplate<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">446</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$Proxy89<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>SqlSessionTemplate<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>SqlSessionTemplate<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">166</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>MapperMethod<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>MapperMethod<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">82</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>MapperProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>MapperProxy<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$Proxy91<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>ikentop<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>hh<span class="token punctuation">.</span>ImageRecordMapperTest<span class="token punctuation">.</span><span class="token function">testSimply</span><span class="token punctuation">(</span>ImageRecordMapperTest<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">)</span>
    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>NativeMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>Method<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span>FrameworkMethod$<span class="token number">1</span><span class="token punctuation">.</span><span class="token function">runReflectiveCall</span><span class="token punctuation">(</span>FrameworkMethod<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span>ReflectiveCallable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ReflectiveCallable<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>model<span class="token punctuation">.</span>FrameworkMethod<span class="token punctuation">.</span><span class="token function">invokeExplosively</span><span class="token punctuation">(</span>FrameworkMethod<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>InvokeMethod<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>InvokeMethod<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunBeforeTestMethodCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunBeforeTestMethodCallbacks<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">75</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunAfterTestMethodCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunAfterTestMethodCallbacks<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">86</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>SpringRepeat<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>SpringRepeat<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">84</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span><span class="token function">runLeaf</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">325</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token function">runChild</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">252</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token function">runChild</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">94</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner$<span class="token number">3</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">290</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner$<span class="token number">1</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span><span class="token function">runChildren</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">288</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span>access$<span class="token function">000</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner$<span class="token number">2</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">268</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunBeforeTestClassCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunBeforeTestClassCallbacks<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">61</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>statements<span class="token punctuation">.</span>RunAfterTestClassCallbacks<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>RunAfterTestClassCallbacks<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runners<span class="token punctuation">.</span>ParentRunner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ParentRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">363</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">191</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>JUnitCore<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>JUnitCore<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">137</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span>JUnit4IdeaTestRunner<span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span>JUnit4IdeaTestRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">68</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>execution<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>IdeaTestRunner$Repeater<span class="token punctuation">.</span><span class="token function">startRunnerWithArgs</span><span class="token punctuation">(</span>IdeaTestRunner<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>execution<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>JUnitStarter<span class="token punctuation">.</span><span class="token function">prepareStreamsAndStart</span><span class="token punctuation">(</span>JUnitStarter<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">237</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>intellij<span class="token punctuation">.</span>rt<span class="token punctuation">.</span>execution<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>JUnitStarter<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>JUnitStarter<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">)</span>
Caused by<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>BuilderException<span class="token operator">:</span> Error invoking SqlProvider <span class="token function">method</span> <span class="token punctuation">(</span>tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>base<span class="token punctuation">.</span>BaseSelectProvider<span class="token punctuation">.</span>dynamicSQL<span class="token punctuation">)</span><span class="token punctuation">.</span>  Cause<span class="token operator">:</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InstantiationException<span class="token operator">:</span> tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>base<span class="token punctuation">.</span>BaseSelectProvider
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ProviderSqlSource<span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>ProviderSqlSource<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">103</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ProviderSqlSource<span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>ProviderSqlSource<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">73</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>MappedStatement<span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>MappedStatement<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">292</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>CachingExecutor<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>CachingExecutor<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">81</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>DefaultSqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>DefaultSqlSession<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">148</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>DefaultSqlSession<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>DefaultSqlSession<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">141</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>DefaultSqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>DefaultSqlSession<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">77</span><span class="token punctuation">)</span>
    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>NativeMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>NativeMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
    at sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>DelegatingMethodAccessorImpl<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>Method<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>SqlSessionTemplate$SqlSessionInterceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>SqlSessionTemplate<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">433</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">34</span> more
Caused by<span class="token operator">:</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>InstantiationException<span class="token operator">:</span> tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>base<span class="token punctuation">.</span>BaseSelectProvider
    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Class<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>Class<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">427</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>ProviderSqlSource<span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>ProviderSqlSource<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">45</span> more
Caused by<span class="token operator">:</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>NoSuchMethodException<span class="token operator">:</span> tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>base<span class="token punctuation">.</span>BaseSelectProvider<span class="token punctuation">.</span>&lt;init<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Class<span class="token punctuation">.</span><span class="token function">getConstructor0</span><span class="token punctuation">(</span>Class<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3082</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Class<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>Class<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">412</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">46</span> more
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å•å…ƒæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@MybatisTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImageRecordMapperTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> ImageRecordMapper mapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ImageRecord record <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"taccisum"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"image1"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"hash1"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="åˆ†æåŸå› "><a href="#åˆ†æåŸå› " class="headerlink" title="åˆ†æåŸå› "></a>åˆ†æåŸå› </h2><p>åœ¨githubä¸Šmapperçš„<a href="https://github.com/abel533/MyBatis-Spring-Boot/issues/34" target="_blank" rel="noopener">issue</a>ä¸­æœ‰ä¸€æ®µä½œè€…çš„å›å¤ï¼Œè¯´æ­¤å¼‚å¸¸æ˜¯ç”±äº<code>é€šç”¨æ–¹æ³•æ²¡æœ‰è¢«æ­£ç¡®åˆå§‹åŒ–</code>å¯¼è‡´ã€‚<br>æˆ‘è¿™è¾¹çš„æƒ…å†µè™½ç„¶å’Œè¿™ä¸ªissueä¸åŒï¼Œä½†æ ¹æœ¬åŸå› æ˜¯ä¸€æ ·çš„ã€‚<br>æŸ¥é˜…<code>Mybatis-Test</code>çš„æ–‡æ¡£å¯çŸ¥ï¼Œ<code>@MybatisTest</code>æ³¨è§£ä¸åŒäº<code>@SpringBootTest</code>ï¼Œå®ƒåªåŠ è½½ä¿è¯Mybatisæ­£å¸¸è¿è¡Œæ‰€éœ€è¦çš„configurationã€‚æ˜¾ç„¶é€šç”¨Mapperä½œä¸ºMybatisç¬¬ä¸‰æ–¹çš„æ‰©å±•ï¼Œå¹¶æ²¡æœ‰è¢«çº³å…¥å…¶ä¸­ï¼Œå› è€Œé»˜è®¤æƒ…å†µä¸‹é€šç”¨Mapperçš„starteræ˜¯ä¸ä¼šè¢«åŠ è½½çš„ï¼Œä¹Ÿå°±å¯¼è‡´é€šç”¨æ–¹æ³•ä¸ä¼šè¢«åˆå§‹åŒ–ã€‚</p>
<blockquote>
<p>The @MybatisTest can be used if you want to test MyBatis components(Mapper interface and SqlSession). By default it will configure MyBatis(MyBatis-Spring) components(SqlSessionFactory and SqlSessionTemplate), configure MyBatis mapper interfaces and configure an in-memory embedded database. MyBatis tests are transactional and rollback at the end of each test by default, for more details refer to the relevant section in the Spring Reference Documentation. Also regular @Component beans will not be loaded into the ApplicationContext.<br>ä»¥ä¸Šæ˜¯æ¥è‡ª<a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-test-autoconfigure/" target="_blank" rel="noopener">mybatis-spring-boot-test-autoconfigure</a>å®˜æ–¹æ–‡æ¡£çš„æè¿°</p>
</blockquote>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æ˜¾ç„¶ï¼Œåªè¦è®©Mapperçš„starteråœ¨MybatisTestçš„å•å…ƒæµ‹è¯•å¯åŠ¨æ—¶å¾—ä»¥åŠ è½½å³å¯è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚é‚£ä¹ˆå¦‚ä½•åšå‘¢ï¼Ÿ<br>Spring Bootæä¾›äº†ä¸€ä¸ª<code>@ImportAutoConfiguration</code>çš„æ³¨è§£ï¼Œå› æ­¤åªéœ€è¦åœ¨å•å…ƒæµ‹è¯•çš„ç›®æ ‡ç±»ä¸Šä½¿ç”¨è¯¥æ³¨è§£å°†MapperAutoConfigurationå¯¼å…¥å³å¯</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ImportAutoConfiguration</span><span class="token punctuation">(</span>MapperAutoConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@MybatisTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImageRecordMapperTest</span> <span class="token punctuation">{</span>
    â€¦â€¦
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­<code>MapperAutoConfiguration</code>æ˜¯é€šç”¨Mapperçš„starterçš„auto-configureç±»ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/learn_gradle_5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/learn_gradle_5.html" class="post-title-link" itemprop="url">Gradleå­¦ä¹ ï¼ˆäº”ï¼‰ - æ‰“åŒ…å‘å¸ƒ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-13 11:32:20" itemprop="dateCreated datePublished" datetime="2017-10-13T11:32:20+08:00">2017-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/gradle/" itemprop="url" rel="index"><span itemprop="name">gradle</span></a>
                </span>
            </span>

          
            <span id="/learn_gradle_5.html" class="post-meta-item leancloud_visitors" data-flag-title="Gradleå­¦ä¹ ï¼ˆäº”ï¼‰ - æ‰“åŒ…å‘å¸ƒ" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/learn_gradle_5.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/learn_gradle_5.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‘å¸ƒåˆ°Mavenä»“åº“"><a href="#å‘å¸ƒåˆ°Mavenä»“åº“" class="headerlink" title="å‘å¸ƒåˆ°Mavenä»“åº“"></a>å‘å¸ƒåˆ°Mavenä»“åº“</h2><h3 id="Maven-Publishæ’ä»¶"><a href="#Maven-Publishæ’ä»¶" class="headerlink" title="Maven-Publishæ’ä»¶"></a>Maven-Publishæ’ä»¶</h3><p>Gradleå°†é¡¹ç›®å‘å¸ƒåˆ°Mavenä»“åº“éœ€è¦å€ŸåŠ©æ’ä»¶ï¼Œ<code>Maven-Publish</code>ä¾¿æ˜¯å®˜æ–¹æ¨èçš„ä¸€æ¬¾æ’ä»¶ã€‚<br><a href="https://docs.gradle.org/current/userguide/publishing_maven.html" target="_blank" rel="noopener">Maven-Publish</a></p>
<h3 id="å‘å¸ƒé¡¹ç›®"><a href="#å‘å¸ƒé¡¹ç›®" class="headerlink" title="å‘å¸ƒé¡¹ç›®"></a>å‘å¸ƒé¡¹ç›®</h3><p>é€šè¿‡<code>&#39;maven-publish&#39;</code>å¼•å…¥æ’ä»¶<br><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">apply plugin<span class="token punctuation">:</span> <span class="token string">'maven-publish'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="å‘å¸ƒåˆ°æœ¬åœ°"><a href="#å‘å¸ƒåˆ°æœ¬åœ°" class="headerlink" title="å‘å¸ƒåˆ°æœ¬åœ°"></a>å‘å¸ƒåˆ°æœ¬åœ°</h4><p><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'maven-publish'</span>

group <span class="token operator">=</span> <span class="token string">'cn.tac.test'</span>
version <span class="token operator">=</span> <span class="token string">'1.0'</span>

publishing <span class="token punctuation">{</span>
    publications <span class="token punctuation">{</span>
        <span class="token function">mavenJava</span><span class="token punctuation">(</span>MavenPublication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            from components<span class="token operator">.</span>java
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
publishing <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        maven <span class="token punctuation">{</span>
            url <span class="token string">"$buildDir/repo"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ä»¥ä¸Šé…ç½®ä¸­</p>
<ul>
<li><code>publishing{}</code>æ˜¯ç”±æ’ä»¶ä¸ºé¡¹ç›®åˆ›å»ºçš„æ‰©å±•ï¼ˆPublishingExtensionç±»å‹ï¼‰ï¼Œè¿™ä¸ªæ‰©å±•æä¾›äº†ä¸¤ä¸ªblockï¼š<code>publications{}</code>ï¼ˆMavenPublicationç±»å‹ï¼‰å’Œ<code>repositories{}</code>ï¼ˆMavenArtifactRepository ç±»å‹ï¼‰ï¼Œåˆ†åˆ«ç”¨äºé…ç½®<code>è¦å‘å¸ƒçš„å†…å®¹</code>å’Œ<code>ç›®æ ‡ä»“åº“</code>ï¼ˆå‡å¯é…ç½®å¤šä¸ªï¼‰ã€‚</li>
<li><code>mavenJava{}</code>è¢«ç§°ä¸ºå‘å¸ƒç»„ä»¶<code>Component</code>ï¼Œç”¨äºé…ç½®ä¸€é¡¹è¦å‘å¸ƒçš„å†…å®¹ï¼Œcomponents.javaè¡¨ç¤ºè¿™ä¸ªç»„ä»¶æ˜¯é€šè¿‡Javaæ’ä»¶æ·»åŠ çš„<code>java</code>ç»„ä»¶ï¼Œå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºå°±æ˜¯å°†å½“å‰javaé¡¹ç›®ä½œä¸ºå‘å¸ƒå†…å®¹ã€‚</li>
<li><code>maven{}</code>æŒ‡å®šäº†ä¸€ä¸ªè¦å‘å¸ƒçš„ç›®æ ‡ä»“åº“ï¼Œå½“å‰æŒ‡å®šäº†å½“å‰é¡¹ç›®çš„buildç›®å½•ä¸‹çš„<code>repo</code>ç›®å½•ï¼Œå³å‘å¸ƒåˆ°æœ¬åœ°</li>
</ul>
<p>æ‰§è¡Œpublishing -&gt; publishï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®æˆåŠŸå‘å¸ƒåˆ°äº†<code>build/repo</code>ç›®å½•ä¸­ã€‚<br><img src="/images/gradle_learn/publishing/build_repo.png" alt="build/repo"></p>
<p><strong>tips</strong></p>
<ul>
<li>ä¸¤ä¸ª<code>publishing{}</code>å—çš„å†…å®¹ä¹Ÿå¯ä»¥åˆåœ¨ä¸€èµ·å†™</li>
<li>mavenJavaåªæ˜¯ä¸€ä¸ªå‘½åï¼Œå¹¶æ— ç‰¹æ®Šå«ä¹‰ï¼Œä½ ä¹Ÿå¯ä»¥å°†å…¶æ›´æ¢ä¸ºåˆ«çš„åç§°ï¼Œä½†ä¸èƒ½ä¸å…¶å®ƒå‘å¸ƒç»„ä»¶åç§°é‡å¤</li>
<li>mavenJavaå—ä¸­è¿˜å¯ä»¥é…ç½®è¦å‘å¸ƒçš„artifactçš„<code>group</code>ã€<code>id</code>åŠ<code>version</code>ï¼Œå¦‚æœä¸æ˜¾å¼æŒ‡å®šï¼Œåˆ™é»˜è®¤é‡‡ç”¨å½“å‰é¡¹ç›®çš„é…ç½®</li>
</ul>
<h4 id="å‘å¸ƒæºç "><a href="#å‘å¸ƒæºç " class="headerlink" title="å‘å¸ƒæºç "></a>å‘å¸ƒæºç </h4><p>åœ¨ä¸Šä¸€æ­¥çš„åŸºç¡€ä¸Š</p>
<ol>
<li>æ–°å¢ä¸€ä¸ªç”¨äºè·å–æºç çš„task</li>
<li>é…ç½®å‘å¸ƒç»„ä»¶ï¼Œä½¿å…¶å‘å¸ƒçš„åŒæ—¶é¢å¤–å‘å¸ƒä¸€ä¸ªåŒ…å«æºç çš„<code>artifact</code></li>
</ol>
<p><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">â€¦â€¦
<span class="token comment" spellcheck="true">//è¿™ä¸ªtaskå¯ä»¥è·å–åˆ°æºç </span>
task <span class="token function">sourceJar</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> Jar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    from sourceSets<span class="token operator">.</span>main<span class="token operator">.</span>allJava
<span class="token punctuation">}</span>

publishing <span class="token punctuation">{</span>
    publications <span class="token punctuation">{</span>
        <span class="token function">mavenJava</span><span class="token punctuation">(</span>MavenPublication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            â€¦â€¦
            <span class="token comment" spellcheck="true">//é…ç½®é¢å¤–å‘å¸ƒçš„artifact</span>
            artifact sourceJar <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//è¿™ä¸ªå­—ç¬¦ä¸²ä¼šä½œä¸ºartifactæ–‡ä»¶çš„åç¼€</span>
                classifier <span class="token string">"sources"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
â€¦â€¦
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œtask<br><img src="/images/gradle_learn/publishing/build_repo_with_sources.png" alt="sources"></p>
<h4 id="å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“"><a href="#å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“"></a>å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“</h4><p>åªéœ€è¦ä¿®æ”¹urlæŒ‡å‘è¿œç¨‹ä»“åº“å³å¯ã€‚åŒæ—¶ç”±äºè¿œç¨‹ä»“åº“å¤§å¤šéœ€è¦è®¤è¯ï¼Œå› æ­¤é€šå¸¸éœ€è¦é€šè¿‡<code>credentials{}</code>æŒ‡å®šç”¨æˆ·åå’Œå¯†ç </p>
<p><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">â€¦â€¦
publishing <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        maven <span class="token punctuation">{</span>
            url <span class="token string">"http://172.10.10.66:8081/nexus/content/repositories/releases/"</span>
            credentials <span class="token punctuation">{</span>
                username <span class="token operator">=</span> <span class="token string">"admin"</span>
                password <span class="token operator">=</span> <span class="token string">"admin123"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
â€¦â€¦
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ¡ä»¶å‘å¸ƒ"><a href="#æ¡ä»¶å‘å¸ƒ" class="headerlink" title="æ¡ä»¶å‘å¸ƒ"></a>æ¡ä»¶å‘å¸ƒ</h4><p>è¿™ç‚¹ç›¸ä¿¡ä¼šç‚¹groovyçš„åŒå­¦éƒ½ä¸ä¼šè§‰å¾—éš¾ï¼Œç”¨<code>if/else</code>å°±å¯ä»¥å®Œæˆã€‚ä¾‹å¦‚ä¸‹é¢çš„é…ç½®å®ç°æ ¹æ®versionåç¼€æ¥å†³å®šæ˜¯å‘å¸ƒåˆ°<code>snapshots</code>è¿˜æ˜¯<code>releases</code>ä»“åº“ä¸­</p>
<p><strong>build.gralde</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">â€¦â€¦
publishing <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token keyword">def</span> NEXUS_URL <span class="token operator">=</span> <span class="token string">"http://172.10.10.66:8081/nexus/content/repositories/releases/"</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>project<span class="token operator">.</span>version<span class="token operator">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"SNAPSHOT"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            NEXUS_URL <span class="token operator">=</span> <span class="token string">"http://172.10.10.66:8081/nexus/content/repositories/snapshots/"</span>
        <span class="token punctuation">}</span>
        maven <span class="token punctuation">{</span>
            url NEXUS_URL
            credentials <span class="token punctuation">{</span>
                username <span class="token operator">=</span> <span class="token string">"admin"</span>
                password <span class="token operator">=</span> <span class="token string">"admin123"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
â€¦â€¦
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="å‘å¸ƒå¤šé¡¹ç›®"><a href="#å‘å¸ƒå¤šé¡¹ç›®" class="headerlink" title="å‘å¸ƒå¤šé¡¹ç›®"></a>å‘å¸ƒå¤šé¡¹ç›®</h4><p>çˆ¶é¡¹ç›®çš„taskæ‰§è¡Œçš„åŒæ—¶ä¼šæ‰§è¡Œå…¶æ‰€æœ‰å­é¡¹ç›®çš„åŒä¸€taskï¼ˆæœ€å¸¸è§çš„å¦‚buildä»»åŠ¡ï¼‰ï¼Œå› æ­¤å¤šé¡¹ç›®å‘å¸ƒåªéœ€è¦é…ç½®å¥½æ‰€æœ‰å­é¡¹ç›®çš„å‘å¸ƒé…ç½®å³å¯ã€‚</p>
<p><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">subprojects <span class="token punctuation">{</span>
    apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
    apply plugin<span class="token punctuation">:</span> <span class="token string">'maven-publish'</span>

    group <span class="token string">"cn.tac.test"</span>
    version <span class="token string">"1.0-SNAPSHOT"</span>

    <span class="token comment" spellcheck="true">//å› ä¸ºçˆ¶é¡¹ç›®ä¸éœ€è¦å‘å¸ƒï¼Œæ‰€ä»¥åªéœ€è¦é…ç½®å­é¡¹ç›®çš„å‘å¸ƒé…ç½®å³å¯</span>
    publishing <span class="token punctuation">{</span>
        publications <span class="token punctuation">{</span>
            <span class="token function">mavenJava</span><span class="token punctuation">(</span>MavenPublication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                from components<span class="token operator">.</span>java
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    publishing <span class="token punctuation">{</span>
        repositories <span class="token punctuation">{</span>
            maven <span class="token punctuation">{</span>
                url <span class="token string">"$buildDir/repo"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œtaskï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªå­é¡¹ç›®éƒ½å‘å¸ƒåˆ°äº†å…¶å¯¹åº”çš„<code>build/repo</code>ä¸­ã€‚</p>
<p><strong>tips</strong></p>
<ul>
<li>å¦‚æœå­æ¨¡å—ä¹‹é—´äº’ç›¸æœ‰ä¾èµ–ï¼ŒGradleå‘å¸ƒæ—¶ä¼šè‡ªåŠ¨è§£æå„æ¨¡å—çš„å…ˆåå‘å¸ƒé¡ºåºï¼Œæ— éœ€æˆ‘ä»¬è‡ªå·±é…ç½®</li>
</ul>
<h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><h4 id="å‘å¸ƒåpom-xmlä¸­é¡¹ç›®çš„ä¾èµ–scopeä¸ºruntimeçš„é—®é¢˜"><a href="#å‘å¸ƒåpom-xmlä¸­é¡¹ç›®çš„ä¾èµ–scopeä¸ºruntimeçš„é—®é¢˜" class="headerlink" title="å‘å¸ƒåpom.xmlä¸­é¡¹ç›®çš„ä¾èµ–scopeä¸ºruntimeçš„é—®é¢˜"></a>å‘å¸ƒåpom.xmlä¸­é¡¹ç›®çš„ä¾èµ–scopeä¸ºruntimeçš„é—®é¢˜</h4><p>åœ¨å‘å¸ƒçš„æ—¶å€™å‘ç°ï¼Œé¡¹ç›®ä¸­é€šè¿‡complieä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“æˆ–å…¶å®ƒæ¨¡å—ï¼Œåœ¨å‘å¸ƒåç”±Gradleç”Ÿæˆçš„<code>pom.xml</code>æ–‡ä»¶ä¸­ï¼Œä¾èµ–çš„scopeé»˜è®¤å˜æˆäº†<code>runtime</code>ï¼Œè€Œéæˆ‘ä»¬æœŸæœ›çš„<code>compile</code></p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
  â€¦â€¦
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.tac.test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>publishing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.tac.test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>module1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸ºäº†è¾¾åˆ°æœŸæœ›çš„æ•ˆæœï¼Œåªéœ€è¦åœ¨å‘å¸ƒé…ç½®ä¸­é€šè¿‡<code>withXML</code>å¯¹pomè¿›è¡Œä¿®æ”¹å³å¯<br><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">publishing <span class="token punctuation">{</span>
    publications <span class="token punctuation">{</span>
        <span class="token function">mavenJava</span><span class="token punctuation">(</span>MavenPublication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            from components<span class="token operator">.</span>java

            pom<span class="token operator">.</span>withXml <span class="token punctuation">{</span>
                <span class="token function">asNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>dependencies<span class="token operator">.</span><span class="token string">'*'</span><span class="token operator">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    it<span class="token operator">.</span>scope<span class="token operator">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'runtime'</span> <span class="token operator">&amp;&amp;</span> project<span class="token operator">.</span>configurations<span class="token operator">.</span>compile<span class="token operator">.</span>allDependencies<span class="token operator">.</span>find <span class="token punctuation">{</span> dep <span class="token operator">-></span>
                        dep<span class="token operator">.</span>name <span class="token operator">==</span> it<span class="token operator">.</span>artifactId<span class="token operator">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token operator">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    it<span class="token operator">.</span>scope<span class="token operator">*.</span>value <span class="token operator">=</span> <span class="token string">'compile'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å†æ¬¡å‘å¸ƒ</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
  â€¦â€¦
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.tac.test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>publishing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.tac.test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>module1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tips</strong></p>
<ul>
<li>å‚è€ƒé“¾æ¥ <a href="https://stackoverflow.com/questions/31069666/how-to-change-artifactory-runtime-scope-to-compile-scope" target="_blank" rel="noopener">How to change artifactory runtime scope to compile scope?</a></li>
<li><a href="https://docs.gradle.org/current/dsl/org.gradle.api.publish.maven.MavenPom.html#org.gradle.api.publish.maven.MavenPom:withXml(org.gradle.api.Action" target="_blank" rel="noopener">æ›´å¤šwithXMLçš„ä¿¡æ¯</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/know_crawler.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/know_crawler.html" class="post-title-link" itemprop="url">äº†è§£çˆ¬è™«</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-01 23:08:55" itemprop="dateCreated datePublished" datetime="2017-10-01T23:08:55+08:00">2017-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/çˆ¬è™«/" itemprop="url" rel="index"><span itemprop="name">çˆ¬è™«</span></a>
                </span>
            </span>

          
            <span id="/know_crawler.html" class="post-meta-item leancloud_visitors" data-flag-title="äº†è§£çˆ¬è™«" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/know_crawler.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/know_crawler.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä»€ä¹ˆæ˜¯çˆ¬è™«"><a href="#ä»€ä¹ˆæ˜¯çˆ¬è™«" class="headerlink" title="ä»€ä¹ˆæ˜¯çˆ¬è™«"></a>ä»€ä¹ˆæ˜¯çˆ¬è™«</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>çˆ¬è™«ï¼ˆWeb Crawlerï¼‰ï¼Œä¹Ÿå«<code>ç½‘ç»œèœ˜è››</code>ï¼ˆSpliderï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨æ¥è‡ªåŠ¨æµè§ˆ<code>wwwç½‘é¡µ</code>çš„ç¨‹åºã€‚<br>çˆ¬è™«ä¸€èˆ¬ä»ä¸€ä¸ªURLå‡ºå‘ï¼Œè®¿é—®æ‰€æœ‰<code>å…³è”çš„URL</code>ï¼Œå¹¶ä»ä¸­æå–å‡ºæ„Ÿå…´è¶£çš„å†…å®¹ã€‚<br>çˆ¬è™«è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹ä¼š<code>æ¶ˆè€—ç›®æ ‡ç³»ç»Ÿèµ„æº</code>ï¼Œæ‰€ä»¥æœ‰ä¸å°‘ç½‘ç»œç³»ç»Ÿå¹¶ä¸é»˜è®¸çˆ¬è™«å·¥ä½œã€‚å› æ­¤çˆ¬è™«è¦è€ƒè™‘åˆ°<code>è§„åˆ’</code>ã€<code>è´Ÿè½½</code>ï¼Œå¹¶ä¸”è¦è®²ã€ç¤¼è²Œã€ï¼ˆå‚è€ƒ<a href="https://zh.wikipedia.org/wiki/Robots.txt" target="_blank" rel="noopener">robots.txt</a>ï¼‰ã€‚</p>
<p><a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E7%88%AC%E8%9F%B2" target="_blank" rel="noopener">ç½‘ç»œçˆ¬è™«</a></p>
<h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>çˆ¬è™«ä¸»è¦æœ‰ä»¥ä¸‹åº”ç”¨åœºæ™¯</p>
<ul>
<li>ç§‘å­¦ç ”ç©¶<blockquote>
<p>å¦‚æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ ã€å›¾ç‰‡å¤„ç†ç­‰</p>
</blockquote>
</li>
<li>Webå®‰å…¨<blockquote>
<p>å¦‚ä½¿ç”¨çˆ¬è™«å¯¹ç½‘ç«™æ˜¯å¦å­˜åœ¨æŸä¸€æ¼æ´è¿›è¡Œæ‰¹é‡éªŒè¯ã€åˆ©ç”¨</p>
</blockquote>
</li>
<li>äº§å“ç ”å‘<blockquote>
<p>å¦‚é‡‡é›†å„ä¸ªå•†åŸç‰©å“ä»·æ ¼ï¼Œä¸ºç”¨æˆ·æä¾›å¸‚åœºæœ€ä½ä»·</p>
</blockquote>
</li>
<li>èˆ†æƒ…ç›‘æ§<blockquote>
<p>å¦‚æŠ“å–ã€åˆ†ææŸç¤¾äº¤å¹³å°çš„æ•°æ®ï¼Œä»è€Œè¯†åˆ«å‡ºæŸç”¨æˆ·æ˜¯å¦ä¸ºæ°´å†›</p>
</blockquote>
</li>
<li>æœç´¢å¼•æ“<blockquote>
<p>çˆ¬è™«æ˜¯æœç´¢å¼•æ“çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†</p>
</blockquote>
</li>
</ul>
<h3 id="çˆ¬è™«ç­–ç•¥"><a href="#çˆ¬è™«ç­–ç•¥" class="headerlink" title="çˆ¬è™«ç­–ç•¥"></a>çˆ¬è™«ç­–ç•¥</h3><p>ä¸€ä¸ªçˆ¬è™«çš„å®ç°ä¸»è¦ç”±å››å¤§ç­–ç•¥ç»„æˆ</p>
<ul>
<li>é€‰æ‹©ç­–ç•¥<blockquote>
<p>æŒ‡å®šé¡µé¢ä¸‹è½½çš„ç­–ç•¥ï¼Œå¯ç»†åˆ†ä¸º<br><code>é“¾æ¥è·Ÿéšé™åˆ¶</code>ï¼ŒæŒ‡çš„æ˜¯çˆ¬è™«åªæœç´¢ç‰¹å®šç±»å‹ï¼ˆå¦‚HTMLï¼‰çš„èµ„æºï¼Œé¿å…å‘å‡ºè¿‡å¤šçš„è¯·æ±‚ã€‚æˆ–è€…é¿å…è¯·æ±‚ä¸€äº›å¸¦æœ‰â€?â€çš„èµ„æºï¼Œé¿å…ä»ç½‘ç«™ä¸‹è½½æ— é™é‡çš„URL<br><code>URLè§„èŒƒåŒ–</code>ï¼ŒæŒ‡çš„æ˜¯ä»¥æŸç§ä¸€è‡´çš„æ–¹å¼ä¿®æ”¹å’Œæ ‡å‡†åŒ–URLçš„è¿‡ç¨‹ï¼Œé¿å…èµ„æºçš„é‡å¤çˆ¬å–<br><code>è·¯å¾„ä¸Šç§»çˆ¬å–</code>ï¼ŒæŒ‡çˆ¬å–æ¯ä¸ªURLé‡Œæç¤ºçš„æ¯ä¸ªè·¯å¾„ï¼Œä¾‹å¦‚å¯¹äºâ€http: //<a href="http://www.tac.cn/a/b/c.html&quot;ï¼Œè¿˜ä¼šçˆ¬å–&quot;/a/b&quot;ã€&quot;/a&quot;å’Œ&quot;/&quot;è·¯å¾„ã€‚" target="_blank" rel="noopener">www.tac.cn/a/b/c.html&quot;ï¼Œè¿˜ä¼šçˆ¬å–&quot;/a/b&quot;ã€&quot;/a&quot;å’Œ&quot;/&quot;è·¯å¾„ã€‚</a><br><code>ä¸»é¢˜çˆ¬å–</code>ï¼ŒæŒ‡æœ‰æ¡ä»¶åœ°è¿›è¡Œçˆ¬å–ï¼ˆä¾‹å¦‚åªçˆ¬å–ä¸pythonç›¸å…³çš„é¡µé¢ï¼‰ã€‚</p>
</blockquote>
</li>
<li>é‡æ–°è®¿é—®ç­–ç•¥<blockquote>
<p>ç½‘ç«™æ˜¯ç»å¸¸åŠ¨æ€å˜åŒ–çš„ï¼Œéœ€è¦ä¼°ç®—URLçš„<code>æ–°é²œåº¦</code>å’Œ<code>è¿‡æ—¶æ€§</code>ï¼Œä»¥ç¡®ä¿æ˜¯å¦éœ€è¦é‡æ–°è®¿é—®ã€‚</p>
</blockquote>
</li>
<li>å¹³è¡¡ç¤¼è²Œç­–ç•¥<blockquote>
<p>ä½¿ç”¨çˆ¬è™«å¯èƒ½å¯¼è‡´ä¸€ä¸ª<code>ç«™ç‚¹ç˜«ç—ª</code>ï¼Œå› æ­¤çˆ¬è™«éœ€è¦éµå®ˆä¸€äº›åè®®æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
</li>
<li>å¹¶è¡Œç­–ç•¥<blockquote>
<p>å¹¶è¡Œè¿è¡Œ<code>å¤šä¸ªè¿›ç¨‹</code>çš„çˆ¬è™«æ—¶ï¼Œä¸ºäº†é¿å…é‡å¤ä¸‹è½½é¡µé¢ï¼Œçˆ¬è™«ç³»ç»Ÿéœ€è¦ç­–ç•¥æ¥å¤„ç†çˆ¬è™«è¿è¡Œæ—¶æ–°å‘ç°çš„URLã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="ç®€å•æ¶æ„"><a href="#ç®€å•æ¶æ„" class="headerlink" title="ç®€å•æ¶æ„"></a>ç®€å•æ¶æ„</h3><p><img src="/images/crawler_learn/framework.jpg" alt="framework"></p>
<p>å¦‚å›¾ï¼Œä¸€ä¸ªæœ€ç®€å•çš„çˆ¬è™«æ¶æ„è‡³å°‘åŒ…æ‹¬<code>çˆ¬è™«è°ƒåº¦ç«¯</code>ã€<code>URLç®¡ç†å™¨</code>ã€<code>ç½‘é¡µä¸‹è½½å™¨</code>ã€<code>ç½‘é¡µè§£æå™¨</code>ã€‚è¿™å‡ ä¸ªæ¨¡å—ç›¸äº’ä½œç”¨ï¼Œä»è€Œæå–å‡º<code>æœ‰ä»·å€¼çš„æ•°æ®</code>ã€‚å…¶æ—¶åºå›¾å¦‚ä¸‹</p>
<p><img src="/images/crawler_learn/sequence_chart.jpg" alt="framework"></p>
<p>çˆ¬è™«è°ƒåº¦å™¨ä»URLç®¡ç†å™¨ä¸­è·å–å¾…çˆ¬å–çš„URLï¼Œäº¤ç”±ä¸‹è½½å™¨è¿›è¡Œä¸‹è½½ã€‚ç„¶åå°†ä¸‹è½½å™¨å°†ä¸‹è½½çš„é¡µé¢äº¤ç”±è§£æå™¨è¿›è¡Œè§£æï¼Œè§£æå™¨åˆåè¿‡æ¥å°†è§£æåˆ°çš„URLåé¦ˆç»™URLç®¡ç†å™¨ã€‚å¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œç›´åˆ°æ²¡æœ‰å¾…æŠ“å–çš„URLï¼Œåˆ™ç»“æŸçˆ¬å–ã€‚</p>
<p>â€”â€”ä»¥ä¸Šå›¾ç‰‡æ¥è‡ªæ…•è¯¾ç½‘<a href="http://www.imooc.com/learn/563" target="_blank" rel="noopener">Pythonå¼€å‘ç®€å•çˆ¬è™«</a></p>
<h3 id="URLç®¡ç†å™¨"><a href="#URLç®¡ç†å™¨" class="headerlink" title="URLç®¡ç†å™¨"></a>URLç®¡ç†å™¨</h3><p>ç®¡ç†å¾…æŠ“å–çš„URLé›†åˆå’Œå·²æŠ“å–çš„URLé›†åˆï¼Œé˜²æ­¢<code>é‡å¤æŠ“å–</code>ã€é˜²æ­¢<code>å¾ªç¯æŠ“å–</code>ã€‚</p>
<p>å®ç°æ–¹å¼</p>
<ul>
<li>å†…å­˜</li>
<li>å…³ç³»æ•°æ®åº“</li>
<li>NoSQL</li>
</ul>
<h3 id="ç½‘é¡µä¸‹è½½å™¨"><a href="#ç½‘é¡µä¸‹è½½å™¨" class="headerlink" title="ç½‘é¡µä¸‹è½½å™¨"></a>ç½‘é¡µä¸‹è½½å™¨</h3><ul>
<li>urllib2 pythonå®˜æ–¹ *</li>
</ul>
<ul>
<li>requests ç¬¬ä¸‰æ–¹</li>
</ul>
<p>ç½‘é¡µä¸‹è½½åˆ†å‡ ç§åœºæ™¯</p>
<ul>
<li>ç›´æ¥é€šè¿‡urlä¸‹è½½</li>
<li>éœ€è¦æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚å¤´ï¼ˆä¼ªè£…æµè§ˆå™¨ï¼‰</li>
<li>éœ€è¦ä¼ªè£…ç‰¹æ®Šæƒ…æ™¯ï¼Œå¦‚cookieã€proxyã€httpsã€http redirect</li>
</ul>
<h3 id="é¡µé¢è§£æå™¨"><a href="#é¡µé¢è§£æå™¨" class="headerlink" title="é¡µé¢è§£æå™¨"></a>é¡µé¢è§£æå™¨</h3><p>ä»ç½‘é¡µä¸­æå–æœ‰ä»·å€¼æ•°æ®çš„å·¥å…·</p>
<p>pythonçš„ç½‘é¡µè§£æå™¨</p>
<ul>
<li>æ­£åˆ™è¡¨è¾¾å¼</li>
<li>html.parser pythonå®˜æ–¹</li>
<li>beautiful soup4 ç¬¬ä¸‰æ–¹ *</li>
<li>lxml </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/learn_gradle_4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/learn_gradle_4.html" class="post-title-link" itemprop="url">Gradleå­¦ä¹ ï¼ˆå››ï¼‰ - è‡ªå®šä¹‰ä»»åŠ¡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-30 18:26:51" itemprop="dateCreated datePublished" datetime="2017-09-30T18:26:51+08:00">2017-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/gradle/" itemprop="url" rel="index"><span itemprop="name">gradle</span></a>
                </span>
            </span>

          
            <span id="/learn_gradle_4.html" class="post-meta-item leancloud_visitors" data-flag-title="Gradleå­¦ä¹ ï¼ˆå››ï¼‰ - è‡ªå®šä¹‰ä»»åŠ¡" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/learn_gradle_4.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/learn_gradle_4.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>è‰ç¨¿</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/learn_gradle_3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/learn_gradle_3.html" class="post-title-link" itemprop="url">Gradleå­¦ä¹ ï¼ˆä¸‰ï¼‰ - å¤šé¡¹ç›®æ„å»º</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-30 10:17:25" itemprop="dateCreated datePublished" datetime="2017-09-30T10:17:25+08:00">2017-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/gradle/" itemprop="url" rel="index"><span itemprop="name">gradle</span></a>
                </span>
            </span>

          
            <span id="/learn_gradle_3.html" class="post-meta-item leancloud_visitors" data-flag-title="Gradleå­¦ä¹ ï¼ˆä¸‰ï¼‰ - å¤šé¡¹ç›®æ„å»º" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/learn_gradle_3.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/learn_gradle_3.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»<a href="/2017/09/26/Gradleå­¦ä¹ ï¼ˆä¸€ï¼‰/">ç¬¬ä¸€ç¯‡</a>ä¸­æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•æ„å»ºä¸€ä¸ªå•é¡¹ç›®ï¼Œä½†ä»…ä»…è¿™æ ·æ˜¯ä¸å¤Ÿçš„ã€‚å®ç°å¤šé¡¹ç›®çš„æ„å»ºæœ‰åˆ©äº<code>æ¨¡å—åŒ–</code>ï¼Œå¦‚æ­¤ä¸€æ¥æˆ‘ä»¬ä¾¿èƒ½æ›´å¥½åœ°åœ¨ä¸€ä¸ªå¤§å‹é¡¹ç›®ä¸­åˆ†ç¦»æˆ‘ä»¬çš„å…³æ³¨ç‚¹ã€‚</p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><h3 id="åˆ›å»ºæ ¹é¡¹ç›®"><a href="#åˆ›å»ºæ ¹é¡¹ç›®" class="headerlink" title="åˆ›å»ºæ ¹é¡¹ç›®"></a>åˆ›å»ºæ ¹é¡¹ç›®</h3><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºæ ¹é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œgradle init</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ mkdir multi_project
$ gradle init
$ ls
build.gradle    gradle          gradlew         gradlew.bat     settings.gradle
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ¬¡æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹æœ‰ä¸¤ä¸ªæ–‡ä»¶</p>
<ul>
<li>build.gradle<blockquote>
<p>é…ç½®ä¸€äº›åº”ç”¨äºæ‰€æœ‰å­é¡¹ç›®çš„å…¬å…±é…ç½®</p>
</blockquote>
</li>
<li>settings.gradle<blockquote>
<p>æè¿°å„é¡¹ç›®ä¹‹é—´çš„å…³ç³»</p>
</blockquote>
</li>
</ul>
<h3 id="åˆ›å»ºå­é¡¹ç›®"><a href="#åˆ›å»ºå­é¡¹ç›®" class="headerlink" title="åˆ›å»ºå­é¡¹ç›®"></a>åˆ›å»ºå­é¡¹ç›®</h3><p>åœ¨æ ¹ç›®å½•ä¸‹åˆ†åˆ«åˆ›å»ºsub-project1å’Œsub-project2ç›®å½•ï¼Œç„¶ååˆ†åˆ«ä¸ºå…¶åˆ›å»ºbuild.gradle</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ mkdir sub-project1 sub-project2
$ touch sub-project1/build.gradle sub-project2/build.gradle
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ç„¶ååœ¨æ ¹é¡¹ç›®çš„settings.gradleä¸­æ·»åŠ ä¸‹é¢å†…å®¹ä»¥å…³è”å­é¡¹ç›®</p>
<pre class="line-numbers language-groovy"><code class="language-groovy">include <span class="token string">'sub-project1'</span>
include <span class="token string">'sub-project2'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>tips</strong></p>
<ul>
<li>ä¸€å®šè¦æ³¨æ„å­é¡¹ç›®åªéœ€ä¸ºå…¶åˆ›å»ºbuild.gradleå³å¯ï¼Œè€Œéä½¿ç”¨gradle initæŒ‡ä»¤åˆå§‹åŒ–ï¼Œè¿™ç‚¹å¾ˆé‡è¦</li>
<li>å­é¡¹ç›®çš„build.gradleåªç”¨äºé…ç½®è¯¥é¡¹ç›®ç‰¹æœ‰çš„ä¸€äº›é…ç½®é¡¹ï¼Œå…¬å…±çš„é…ç½®é€šè¿‡æ ¹é¡¹ç›®çš„build.gradleé…ç½®</li>
</ul>
<h3 id="å…¬å…±é…ç½®"><a href="#å…¬å…±é…ç½®" class="headerlink" title="å…¬å…±é…ç½®"></a>å…¬å…±é…ç½®</h3><p>åœ¨æ ¹é¡¹ç›®çš„build.gradleä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹</p>
<pre class="line-numbers language-groovy"><code class="language-groovy">allprojects<span class="token punctuation">{</span>
    group <span class="token operator">=</span> <span class="token string">'cn.tac'</span>
    version <span class="token operator">=</span> <span class="token string">'0.1'</span>
    repositories<span class="token punctuation">{</span>
        maven <span class="token punctuation">{</span>
            url <span class="token string">'http://maven.aliyun.com/nexus/content/groups/public/'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

subprojects <span class="token punctuation">{</span>
    apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
    sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>
    dependencies <span class="token punctuation">{</span>
        testCompile <span class="token string">'junit:junit:4.12'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>allprojects{}</code> ä¸ºæ‰€æœ‰é¡¹ç›®æ·»åŠ é…ç½®é¡¹ï¼Œæ‰€ä»¥groupã€versionã€repositorieséƒ½æ”¾åœ¨äº†è¿™ä¸ªblockä¸‹</li>
<li><code>subprojects{}</code> ä»…ä»…ä¸ºå½“å‰é¡¹ç›®çš„å­é¡¹ç›®æ·»åŠ é…ç½®é¡¹ï¼ˆä¸åŒ…æ‹¬å½“å‰é¡¹ç›®æœ¬èº«ï¼‰ï¼Œæ‰€ä»¥æ ¹é¡¹ç›®ä¸éœ€è¦çš„å†…å®¹ï¼ˆå¦‚ä¾èµ–ï¼‰æ”¾åœ¨äº†è¿™ä¸ªblockä¸‹</li>
</ul>
<h3 id="ç¼–å†™ä»£ç "><a href="#ç¼–å†™ä»£ç " class="headerlink" title="ç¼–å†™ä»£ç "></a>ç¼–å†™ä»£ç </h3><p>åˆ†åˆ«ä¸ºå­é¡¹ç›®åˆ›å»ºsrcç›®å½•</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ mkdir -p sub-project1/src/test/java/cn/tac/gradle sub-project2/src/test/java/cn/tac/gradle
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¹¶åˆ›å»ºå•å…ƒæµ‹è¯•</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>gradle<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Assert<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubProject1Test</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello, i'm sub project1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>gradle<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Assert<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubProject2Test</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello, i'm sub project2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æ‰§è¡Œæ„å»º"><a href="#æ‰§è¡Œæ„å»º" class="headerlink" title="æ‰§è¡Œæ„å»º"></a>æ‰§è¡Œæ„å»º</h3><p>å®Œæˆäº†ä¸Šè¿°æ­¥éª¤ä¹‹åï¼Œä¸å‡ºæ„å¤–æ­¤æ—¶çš„ç›®å½•ç»“æ„åº”è¯¥å¦‚ä¸‹</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ tree .
.
â”œâ”€â”€ build.gradle
â”œâ”€â”€ gradle
â”‚   â””â”€â”€ wrapper
â”‚       â”œâ”€â”€ gradle-wrapper.jar
â”‚       â””â”€â”€ gradle-wrapper.properties
â”œâ”€â”€ gradlew
â”œâ”€â”€ gradlew.bat
â”œâ”€â”€ settings.gradle
â”œâ”€â”€ sub-project1
â”‚   â”œâ”€â”€ build.gradle
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ test
â”‚           â””â”€â”€ java
â”‚               â””â”€â”€ cn
â”‚                   â””â”€â”€ tac
â”‚                       â””â”€â”€ gradle
â”‚                           â””â”€â”€ SubProject1Test.java
â””â”€â”€ sub-project2
    â”œâ”€â”€ build.gradle
    â””â”€â”€ src
        â””â”€â”€ test
            â””â”€â”€ java
                â””â”€â”€ cn
                    â””â”€â”€ tac
                        â””â”€â”€ gradle
                            â””â”€â”€ SubProject2Test.java
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ‡æ¢åˆ°æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ</p>
<pre><code>$ sh gradlew build
</code></pre><p>å†æŸ¥çœ‹å­é¡¹ç›®çš„ç›®å½•ï¼Œå‘ç°åˆ†åˆ«å¤šäº†ä¸€ä¸ªbuildç›®å½•ï¼Œå¯è§åœ¨ä¸ºæ ¹é¡¹ç›®æ‰§è¡Œæ„å»ºä»»åŠ¡æ—¶ï¼Œå…¶includeçš„æ‰€æœ‰å­é¡¹ç›®ä¹Ÿåˆ†åˆ«è¿›è¡Œäº†æ„å»ºã€‚ä»¥ä¸‹åˆ†åˆ«æ˜¯ä¸¤ä¸ªå­é¡¹ç›®çš„build reports<br><img src="/images/gradle_learn/multi_project/subproject1test.png" alt="sub project 1"><br><img src="/images/gradle_learn/multi_project/subproject2test.png" alt="sub project 2"></p>
<h3 id="ä¾èµ–å…¶å®ƒé¡¹ç›®"><a href="#ä¾èµ–å…¶å®ƒé¡¹ç›®" class="headerlink" title="ä¾èµ–å…¶å®ƒé¡¹ç›®"></a>ä¾èµ–å…¶å®ƒé¡¹ç›®</h3><p>åœ¨<code>dependencies{}</code>ä¸­æ·»åŠ ä¾èµ–å³å¯ï¼Œä¾‹å¦‚sub-project2è¦ä¾èµ–sub-project1ï¼Œå¯ä»¥åœ¨sub-project2çš„build.gradleä¸­æ·»åŠ </p>
<pre class="line-numbers language-groovy"><code class="language-groovy">dependencies <span class="token punctuation">{</span>
  compile <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">':sub-project1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/learn_gradle_2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/learn_gradle_2.html" class="post-title-link" itemprop="url">Gradleå­¦ä¹ ï¼ˆäºŒï¼‰ - å¸¸ç”¨æ’ä»¶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-26 17:56:40" itemprop="dateCreated datePublished" datetime="2017-09-26T17:56:40+08:00">2017-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/gradle/" itemprop="url" rel="index"><span itemprop="name">gradle</span></a>
                </span>
            </span>

          
            <span id="/learn_gradle_2.html" class="post-meta-item leancloud_visitors" data-flag-title="Gradleå­¦ä¹ ï¼ˆäºŒï¼‰ - å¸¸ç”¨æ’ä»¶" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/learn_gradle_2.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/learn_gradle_2.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="build-scanï¼ˆæ„å»ºå®¡è§†ï¼‰æ’ä»¶"><a href="#build-scanï¼ˆæ„å»ºå®¡è§†ï¼‰æ’ä»¶" class="headerlink" title="build-scanï¼ˆæ„å»ºå®¡è§†ï¼‰æ’ä»¶"></a>build-scanï¼ˆæ„å»ºå®¡è§†ï¼‰æ’ä»¶</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><blockquote>
<p>A build scan is a shareable and centralized record of a build that provides insights into what happened and why. By applying the build scan plugin to your project, you can create a build scan in the Gradle Cloud for free.<br><a href="https://guides.gradle.org/creating-build-scans/" target="_blank" rel="noopener">Creating Build Scans</a></p>
</blockquote>
<p>å¤§æ¦‚çš„æ„æ€æ˜¯build scanèƒ½ä¸ºä½ æä¾›æ„å»ºè¿‡ç¨‹ä¸­å‘ç”Ÿçš„what and whyä¿¡æ¯ï¼Œåœ¨ä½ æ„å»ºçš„æ—¶å€™ï¼Œæ’ä»¶ä¼šæŠ“å–æ•°æ®æäº¤åˆ°<code>Gradle Cloud</code>ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªåŒ…å«æ„å»ºä¿¡æ¯çš„é“¾æ¥ã€‚</p>
<p><strong>å·¥ä½œæµç¨‹</strong><br><img src="https://docs.gradle.com/build-scan-plugin/images/build-scan-service-overview.svg" alt="overview"></p>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>é…ç½®æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨build.gradleä¸­åŠ å…¥</p>
<pre class="line-numbers language-groovy"><code class="language-groovy">plugins <span class="token punctuation">{</span>
    id <span class="token string">'com.gradle.build-scan'</span> version <span class="token string">'1.9'</span> 
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ·»åŠ äº†æ’ä»¶åï¼Œå¯ä»¥é€šè¿‡buildScanå—æ¥é…ç½®æ’ä»¶ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ª<code>license</code>ç›¸å…³çš„å±æ€§æ˜¯<strong><em>å¿…éœ€è¦é…ç½®</em></strong>çš„</p>
<pre class="line-numbers language-groovy"><code class="language-groovy">buildScan <span class="token punctuation">{</span>
    licenseAgreementUrl <span class="token operator">=</span> <span class="token string">'https://gradle.com/terms-of-service'</span>
    licenseAgree <span class="token operator">=</span> <span class="token string">'yes'</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>import changesï¼ˆå¦‚æœæ²¡æœ‰å‹¾é€‰auto-importï¼‰ï¼Œå¯ä»¥çœ‹åˆ°Gradle Projecté¢æ¿ä¸Šå¤šäº†ä¸ªtask<br><img src="/images/gradle_build_scan_task.png" alt=""></p>
<p><strong>tip</strong></p>
<ul>
<li>å¦‚æœæ·»åŠ æ–°çš„pluginï¼Œåº”è¯¥ç¡®ä¿build-scan<strong><em>æ€»æ˜¯åœ¨ç¬¬ä¸€ä¸ªä½ç½®</em></strong>ï¼Œå¦åˆ™å…¶ä¹‹å‰çš„æ’ä»¶è™½ç„¶ä»ç„¶æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯æ— æ³•åˆ°æŠ“å–ç›¸å…³çš„æ„å»ºä¿¡æ¯</li>
</ul>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å…ˆæ‰§è¡Œbuild -&gt; buildï¼Œå†æ‰§è¡Œè¿™ä¸ªbuild scan -&gt; buildScanPublishPreviousï¼Œä¸å‡ºæ„å¤–å¯ä»¥çœ‹åˆ°terminalä¸­è¿”å›äº†ä¸€ä¸ªé“¾æ¥</p>
<pre class="line-numbers language-text"><code class="language-text">9:50:39 PM: Executing external task 'buildScanPublishPrevious'...
:buildScanPublishPrevious

Publishing build scan...
https://gradle.com/s/af72je4qbzhme

BUILD SUCCESSFUL

Total time: 1.283 secs
9:50:41 PM: External task execution finished 'buildScanPublishPrevious'.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰“å¼€é“¾æ¥åå¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€ä¸ªç•Œé¢</p>
<p><img src="/images/gradle_build_scan_insight.png" alt="build scan"></p>
<p>æ¥ä¸‹æ¥åœ¨ä»»ä¸€ä¸ªå•å…ƒæµ‹è¯•å†…åŠ å…¥ä¸€è¡Œè®©æ„å»ºå¤±è´¥</p>
<pre class="line-numbers language-java"><code class="language-java">        Assert<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å†æ‰§è¡Œä¸€æ¬¡æ„å»ºï¼Œæ‰“å¼€é“¾æ¥æŸ¥çœ‹<br><img src="/images/gradle_build_scan_insight_failure.png" alt="failed build scan"></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹å‡ å¤§ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä¿¡æ¯å±•ç¤ºéå¸¸å…¨é¢ä¸°å¯Œã€ç›´è§‚</li>
<li>è‰¯å¥½çš„åˆ†ç±»ã€æŠ˜å ï¼Œè®©ç”¨æˆ·è‡ªå·±é€‰æ‹©å±•å¼€æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œéå¸¸å‹å¥½</li>
<li>ç½‘é¡µå½¢å¼ï¼Œéå¸¸æ˜“äºåˆ†äº«ï¼ˆè¿™ä¸€ç‚¹æœ‰ç‚¹ç±»ä¼¼<code>AngularJS</code>çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸è¿‡æ²¡è€ƒå¯Ÿæ˜¯è°å€Ÿé‰´è°çš„ï¼Œæˆ–è®¸ä¸¤è€…éƒ½ä¸æ˜¯åŸåˆ›ï¼Ÿï¼‰ã€‚</li>
</ul>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¿™é‡Œä¸å¾—ä¸æåˆ°ä¸€ç›´è¢«äººåæ§½çš„Mavençš„æ„å»ºä¿¡æ¯ï¼ŒçœŸå¿ƒæ˜¯éå¸¸ä¸å‹å¥½ğŸ˜’</p>
<p><strong>tip</strong></p>
<ul>
<li>å¦‚æœæ„å»ºæ—¶å‡ºç°â€There is no previous build data available to publish.â€ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰å…ˆæ‰§è¡Œä»»ä¸€taskã€‚</li>
</ul>
<h2 id="Applicationæ’ä»¶"><a href="#Applicationæ’ä»¶" class="headerlink" title="Applicationæ’ä»¶"></a>Applicationæ’ä»¶</h2><h3 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>Applicationæ’ä»¶å¯ä»¥è®©ä½ è½»æ¾åœ°åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸‹<code>æ‰§è¡ŒJVMåº”ç”¨</code>ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¸®åŠ©ä½ å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªåŒ…å«äº†å„ç±»æ“ä½œç³»ç»Ÿå¯¹åº”<code>å¯åŠ¨è„šæœ¬</code>çš„tar and/or zipæ–‡ä»¶ã€‚</p>
<p><a href="https://docs.gradle.org/3.5/userguide/application_plugin.html" target="_blank" rel="noopener">The Application Plugin</a></p>
<h3 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">apply plugin<span class="token punctuation">:</span> <span class="token string">'application'</span>
mainClassName <span class="token operator">=</span> <span class="token string">"cn.tac.test.gradle.Application"</span>    <span class="token comment" spellcheck="true">//æŒ‡å®šç¨‹åºå…¥å£ç±»</span>
<span class="token comment" spellcheck="true">//applicationDefaultJvmArgs = ["-Dgreeting.language=en"]      //åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„jvmå‚æ•°</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ·»åŠ äº†Applicationæ’ä»¶åï¼Œé¡¹ç›®ä¼šå¤šå‡ºä»¥ä¸‹å‡ ä¸ªtask</p>
<ul>
<li>run</li>
<li>startScripts</li>
<li>installDist</li>
<li>distZip</li>
<li>distTar</li>
</ul>
<p>å…·ä½“å¯ä»¥é€šè¿‡tasksä»»åŠ¡æŸ¥çœ‹</p>
<p><strong>tips</strong></p>
<ul>
<li>æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼ŒApplicationæ’ä»¶å·²ç»éšå¼åœ°åŒ…æ‹¬äº†<code>Java</code>æ’ä»¶å’Œ<code>Distribution</code>æ’ä»¶ï¼Œå› æ­¤å¦‚æœä½ åŸæ¥å¼•å…¥äº†è¿™ä¸¤ä¸ªæ’ä»¶ï¼Œç°åœ¨å¯ä»¥å»æ‰äº†</li>
</ul>
<h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>ä»¥æˆ‘çš„mainå‡½æ•°ä¸ºä¾‹ï¼ˆæ³¨æ„è¦è·Ÿ<code>mainClassName</code>å±æ€§æŒ‡å®šçš„ç±»ä¸€è‡´ï¼‰</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>test<span class="token punctuation">.</span>gradle<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello, it's you args: "</span> <span class="token operator">+</span> Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
             System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello, you do not input any args"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ‰§è¡Œåº”ç”¨"><a href="#æ‰§è¡Œåº”ç”¨" class="headerlink" title="æ‰§è¡Œåº”ç”¨"></a>æ‰§è¡Œåº”ç”¨</h4><pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew run

> Task :run
hello, you do not input any args
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœè¦<code>ä¼ å…¥å‚æ•°</code>ï¼Œå¯ä»¥é…ç½®ä¸€ä¸‹runä»»åŠ¡<br><strong>build.gradle</strong></p>
<pre class="line-numbers language-groovy"><code class="language-groovy">run <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>project<span class="token operator">.</span><span class="token function">hasProperty</span><span class="token punctuation">(</span><span class="token string">"myArgs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      args myArgs
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢é…ç½®çš„æ„æ€æ˜¯ï¼Œå¦‚æœå½“å‰é¡¹ç›®çš„projectå¯¹è±¡åŒ…å«æœ‰myArgså±æ€§ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œmainå‡½æ•°æ—¶å°±å°†è¿™ä¸ªå±æ€§ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä¹‹åæˆ‘ä»¬å¯ä»¥è¿™æ ·æ‰§è¡Œ</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew run -PmyArgs="123","abc","qaz"

> Task :run
hello, it s you args: [123,abc,qaz]
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­-PmyArgsåˆ†ä¸ºä¸¤éƒ¨åˆ†</p>
<ul>
<li>-Pï¼Œå‘½ä»¤è¡Œoptionã€‚ä½œç”¨æ˜¯æŒ‡å®šä¸€ä¸ªå±æ€§çš„å€¼runï¼Œä¸èƒ½çœå»</li>
<li>myArgsï¼Œæˆ‘ä»¬åˆšåˆšåœ¨runä»»åŠ¡ä¸­è‡ªå®šä¹‰çš„å±æ€§ï¼Œé€šè¿‡-PæŒ‡å®š</li>
</ul>
<h4 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h4><p>æ‰§è¡Œä»¥ä¸‹è„šæœ¬å¯ä»¥è¿›è¡Œæ‰“åŒ…</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew distTar distZip
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ‰“åŒ…å¥½çš„å†…å®¹åœ¨<code>/build/distributions</code>ä¸­ï¼Œåˆ†åˆ«å¤šäº†ä¸€ä¸ªtaræ–‡ä»¶å’Œä¸€ä¸ªzipæ–‡ä»¶ï¼Œè§£å‹åæŸ¥çœ‹ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ tree .
.
â”œâ”€â”€ bin
â”‚   â”œâ”€â”€ gradle_cli
â”‚   â””â”€â”€ gradle_cli.bat
â””â”€â”€ lib
    â””â”€â”€ gradle_cli-1.0.jar
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tips</strong></p>
<ul>
<li>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡buildä»»åŠ¡æ¥æ‰“åŒ…ï¼Œbuildä»»åŠ¡ä¼šè‡ªåŠ¨å°†<code>distTar</code>å’Œ<code>distZip</code>ä»»åŠ¡åŒ…æ‹¬è¿›å»</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://taccisum.github.io/learn_gradle_1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="taccisum">
      <meta itemprop="description" content="el psy congroo.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taccisum's blog ğŸ˜‰">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/learn_gradle_1.html" class="post-title-link" itemprop="url">Gradleå­¦ä¹ ï¼ˆä¸€ï¼‰ - Getting Started</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-26 15:39:42" itemprop="dateCreated datePublished" datetime="2017-09-26T15:39:42+08:00">2017-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-13 18:05:01" itemprop="dateModified" datetime="2020-03-13T18:05:01+08:00">2020-03-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/gradle/" itemprop="url" rel="index"><span itemprop="name">gradle</span></a>
                </span>
            </span>

          
            <span id="/learn_gradle_1.html" class="post-meta-item leancloud_visitors" data-flag-title="Gradleå­¦ä¹ ï¼ˆä¸€ï¼‰ - Getting Started" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/learn_gradle_1.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/learn_gradle_1.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è™½ç„¶ä¸€ç›´ä»¥æ¥éƒ½ç”¨Mavenä½œä¸ºjavaé¡¹ç›®çš„æ„å»ºå·¥å…·ï¼Œä½†æ—©å°±å¬è¯´è¿‡Gradleå¤§åï¼Œäºæ˜¯ä»Šå¤©ç»ˆäºæŠ½å‡ºæ—¶é—´æ¥äº†è§£ä¸€ä¸‹è¿™æ¬¾å·ç§°ç»“åˆäº†Antå’ŒMavenä¼˜ç‚¹çš„æ„å»ºå·¥å…·ã€‚<br>è™½ç„¶Gradleæ”¯æŒå¤šç§è¯­è¨€ï¼Œä½†è¿™ä¸ªç³»åˆ—çš„æ–‡ç« ä¸»è¦ä»¥Javaé¡¹ç›®æ„å»ºä¸ºä¸»ã€‚ç”±äºæœ¬äººä¸æ˜¯åšAndroidå¼€å‘ï¼Œæ‰€ä»¥è¿™ä¸ªç³»åˆ—çš„æ–‡ç« å¯èƒ½ä¼šæ›´åå‘äºJava Webå¼€å‘è§†è§’ã€‚</p>
<h2 id="å­¦ä¹ èµ„æºæ¨è"><a href="#å­¦ä¹ èµ„æºæ¨è" class="headerlink" title="å­¦ä¹ èµ„æºæ¨è"></a>å­¦ä¹ èµ„æºæ¨è</h2><p><a href="https://gradle.org/docs/#getting-started" target="_blank" rel="noopener">å®˜æ–¹Documentation</a> å†…å®¹éå¸¸å…¨é¢ï¼Œç¼ºç‚¹æ˜¯å…¨è‹±æ–‡ï¼ˆå¯¹äºè‹±è¯­å·®çš„åŒå­¦ç®€ç›´æ˜¯å™©æ¢¦ï¼‰<br><a href="https://pkaq.gitbooks.io/gradletraining/content/" target="_blank" rel="noopener">ã€Šè·Ÿæˆ‘å­¦Gradleã€‹</a> Graldeä¸­æ–‡ç”¨æˆ·ç»„ç¼–å†™çš„ä¸­æ–‡ç³»åˆ—æ•™ç¨‹ï¼Œç¼ºç‚¹æ˜¯è¿˜ä¸å¤Ÿå®Œå–„ï¼Œæœ‰äº›ç« èŠ‚è¿˜æ²¡æœ‰å†…å®¹<br><a href="https://lippiouyang.gitbooks.io/gradle-in-action-cn/content/index.html" target="_blank" rel="noopener">ã€ŠGradle In Actionã€‹ä¸­è¯‘ç‰ˆ</a> ä¹¦æˆ‘æ²¡å®Œæ•´çœ‹è¿‡ï¼Œåªæ˜¯æŸ¥èµ„æ–™æ—¶è¯»è¿‡å‡ ä¸ªç« èŠ‚ï¼Œæ„Ÿè§‰å†…å®¹è¿˜ä¸é”™</p>
<h2 id="æ¦‚è²Œäº†è§£"><a href="#æ¦‚è²Œäº†è§£" class="headerlink" title="æ¦‚è²Œäº†è§£"></a>æ¦‚è²Œäº†è§£</h2><h3 id="åŒç±»å·¥å…·æ¯”å¯¹"><a href="#åŒç±»å·¥å…·æ¯”å¯¹" class="headerlink" title="åŒç±»å·¥å…·æ¯”å¯¹"></a>åŒç±»å·¥å…·æ¯”å¯¹</h3><p><strong>Ant</strong><br>Antæ˜¯ç¬¬ä¸€ä¸ªâ€œç°ä»£â€æ„å»ºå·¥å…·ï¼Œäº2000å¹´å‘å¸ƒåŸºäºè¿‡ç¨‹å¼ç¼–ç¨‹çš„ideaï¼Œå…·å¤‡<code>æ’ä»¶åŠŸèƒ½</code>åŠé€šè¿‡ç½‘ç»œè¿›è¡Œ<code>ä¾èµ–ç®¡ç†</code>çš„åŠŸèƒ½ï¼ˆç»“åˆApache Ivyï¼‰ã€‚ä¸è¶³ä¹‹å¤„æ˜¯é‡‡ç”¨XMLä½œä¸ºè„šæœ¬ç¼–å†™æ ¼å¼ï¼Œä¸ç¬¦åˆè¿‡ç¨‹åŒ–ç¼–ç¨‹çš„åˆè¡·ã€‚</p>
<p><strong>Maven</strong><br>Mavenå‡ºç°çš„ç›®çš„æ˜¯è§£å†³Antå¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼Œå‘å¸ƒäº2004å¹´ã€‚Mavenä¾é <code>çº¦å®š</code>å¹¶æä¾›ç°æˆçš„å¯è°ƒç”¨çš„ç›®æ ‡ï¼Œé¦–åˆ›äº†ä»ç½‘ç»œä¸‹è½½ä¾èµ–çš„åŠŸèƒ½ã€‚ä¾ç„¶é‡‡ç”¨XMLä½œä¸ºé…ç½®æ–‡ä»¶ï¼ˆå› æ­¤åŒæ ·æœ‰è·ŸAntä¸€æ ·éš¾ä»¥å®šåˆ¶åŒ–æ„å»ºè¿‡ç¨‹çš„ç¼ºç‚¹ï¼‰ã€‚å¦å¤–Mavenè™½ç„¶èšç„¦äºä¾èµ–ç®¡ç†ï¼Œä½†å¹¶ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†ç›¸åŒåº“æ–‡ä»¶ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å†²çªï¼ˆä¸å¦‚Ivyï¼‰ã€‚</p>
<p><strong>Gradle</strong><br>Gradleç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šåšäº†è®¸å¤šæ”¹è¿›ã€‚<br>Gradleä½¿ç”¨åŸºäºGroovyçš„<code>DSL</code>ç¼–å†™æ„å»ºè„šæœ¬ï¼Œå¯ä»¥æ›´ç»†è‡´åœ°æ§åˆ¶ç¼–è¯‘æ‰“åŒ…è¿‡ç¨‹ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆAndroid Studioé»˜è®¤é‡‡ç”¨Gradleä½œä¸ºæ„å»ºå·¥å…·çš„åŸå› ï¼‰ã€‚<br>Gradleå¯¹<code>å¤šæ¨¡å—</code>é¡¹ç›®æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚<br>Gradleæ”¯æŒ<code>å¤šè¯­è¨€</code>ï¼ŒåŒ…æ‹¬javaã€groovyã€scalaã€c++ç­‰ã€‚<br>Gradleä½¿ç”¨Apache Ivyå¤„ç†ä¾èµ–ï¼Œå› æ­¤ä¾èµ–ç®¡ç†æ–¹é¢ä¼˜äºMavenã€‚åŒæ—¶Gradleå¯ä»¥ä½¿ç”¨<code>å¤šç§ç±»å‹çš„è¿œç¨‹ä»“åº“</code>ï¼Œå¦‚Mavenä»“åº“ã€Ivyä»“åº“ã€‚</p>
<h3 id="å…³äºDSL"><a href="#å…³äºDSL" class="headerlink" title="å…³äºDSL"></a>å…³äºDSL</h3><p>DSLæ˜¯<code>Domain Specific Language</code>çš„ç¼©å†™ï¼Œå³é¢†åŸŸç‰¹å®šè¯­è¨€ã€‚åŒå­—é¢ä¸Šçš„æ„æ€ï¼Œå°±æ˜¯ä¸“ç”¨äºå¤„ç†æŸä¸€é¢†åŸŸé—®é¢˜çš„ç‰¹å®šè¯­è¨€ï¼Œä¾‹å¦‚ç”¨äºwebé¡µé¢å¼€å‘çš„HTMLè¯­è¨€ã€ç”¨äºGNU Emacsçš„Emacs Lispç­‰ï¼Œç”šè‡³æœ‰ä¸€äº›ç®€å•çš„DSLåªç”¨äºæŸä¸ªå•åº”ç”¨ç¨‹åºï¼ˆä¹Ÿç§°ä¸ºMini-Languagesï¼‰ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼ŒGradleä½¿ç”¨çš„DSLåº”è¯¥æ˜¯ä¸€ç§ä¸“ç”¨äºé¡¹ç›®æ„å»ºçš„è¯­è¨€ã€‚</p>
<p><a href="https://en.wikipedia.org/wiki/Domain-specific_language" target="_blank" rel="noopener">æ›´å¤šå†…å®¹</a></p>
<h2 id="Getting-Started-IntelliJ-IDEA"><a href="#Getting-Started-IntelliJ-IDEA" class="headerlink" title="Getting Started - IntelliJ IDEA"></a>Getting Started - IntelliJ IDEA</h2><p>åˆæ¬¡æ¥è§¦ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿçœ‹åˆ°æ•ˆæœï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ideæ¥å…¥é—¨ã€‚ä¸è¿‡ä¸ºäº†å¯¹Gradleæœ‰æ›´æ·±å…¥çš„äº†è§£ï¼Œå¾€åçš„ç»ƒä¹ é¡¹ç›®å°†å…¨éƒ¨ä½¿ç”¨å‘½ä»¤è¡Œæ„å»ºã€‚</p>
<h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><ol>
<li>New -&gt; Project -&gt; Gradleï¼Œæ–°å»ºä¸€ä¸ªGradleé¡¹ç›®ï¼ˆå°±åƒMavenä¸€æ ·ï¼ŒIDEAå†…ç½®äº†Gradleï¼Œæ‰€ä»¥ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®‰è£…äº†ï¼‰</li>
<li>å¡«å†™GroupIdã€ArtifactIdã€Versionï¼ˆè¿™äº›è·ŸMavenæ˜¯ä¸€æ ·çš„ï¼‰</li>
<li>è¿™é‡Œå‹¾é€‰ä¸ŠCreate directories for empty content roots automaticallyé€‰é¡¹ï¼Œè®©IDEAå¸®æˆ‘ä»¬åˆ›å»ºå¥½ç›®å½•ç»“æ„</li>
<li>Finishï¼Œåˆæ¬¡æ„å»ºå¯èƒ½ä¼šèŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ï¼ˆè·ŸMavenä¸€æ ·ï¼Œè¦ä»ç½‘ç»œä¸‹è½½ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚é¡¹ç›®æ¨¡æ¿ï¼‰ï¼Œæ„å»ºå¥½åçš„ç›®å½•ç»“æ„å¦‚ä¸‹<br><img src="/images/gradle_project_structure.png" alt="project structure"></li>
</ol>
<p>æ¥çœ‹ä¸‹å„folder&amp;fileçš„å«ä¹‰ï¼š</p>
<ul>
<li>.gradle<blockquote>
<p>Gradleç›¸å…³çš„æ”¯æŒæ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ç”¨å…³å¿ƒ</p>
</blockquote>
</li>
<li>gradle<ul>
<li>wrapper <blockquote>
<p>The wrapper is a small script and supporting jar and properties file that allows a user to execute Gradle tasks even if they donâ€™t already have Gradle installed. Generating a wrapper also ensures that the user will use the same version of Gradle as the person who created the project.<br><a href="https://guides.gradle.org/creating-new-gradle-builds/" target="_blank" rel="noopener">Creating New Gradle Project</a></p>
</blockquote>
å¤§æ„ä¸ºï¼Œwrapperé‡Œé¢æ˜¯ä¸€äº›ç®€å•çš„<code>è„šæœ¬</code>ã€ä½¿ç”¨æˆ·èƒ½åœ¨æ²¡æœ‰å®‰è£…Gradleçš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ‰§è¡ŒGradleä»»åŠ¡çš„supporting <code>jar</code>åŠ<code>properties</code>æ–‡ä»¶ç­‰ï¼ŒåŒæ—¶wrapperè¿˜èƒ½ç¡®ä¿ç”¨æˆ·æ‰§è¡ŒGradleä»»åŠ¡æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬ä¸é¡¹ç›®åˆ›å»ºè€…ä½¿ç”¨çš„Gradleç‰ˆæœ¬ç›¸åŒã€‚<strong>æ€»ä¹‹æ˜¯ä¸€ä¸ªå¼€å‘äººå‘˜åŸºæœ¬ä¸éœ€è¦å…³å¿ƒçš„ç›®å½•ã€‚</strong></li>
</ul>
</li>
<li>src<blockquote>
<p>æºç ç›®å½•ï¼Œé‡‡ç”¨äº†ä¸Mavenç›¸åŒçš„ç»“æ„</p>
</blockquote>
</li>
<li>build.gradle<blockquote>
<p>Gradleçš„æ„å»ºé…ç½®æ–‡ä»¶ï¼ˆbuild fileï¼‰ï¼Œ<strong><em>éœ€è¦æˆ‘ä»¬ç¼–å†™å†…å®¹</em></strong>ï¼ˆç±»ä¼¼Mavençš„pom.xmlï¼‰ã€‚<br>æŒ‰ç…§å®˜æ–¹çš„æè¿°ï¼Œæ¯ä¸ªbuild.gradleéƒ½é…ç½®äº†ä¸€ä¸ª<code>org.gradle.api.Project</code>ç±»çš„å®ä¾‹ï¼Œå¹¶ä¸”è¿™ä¸ªå®ä¾‹ä¼šæœ‰è®¸å¤šå†…å»ºçš„æ–¹æ³•å’Œå±æ€§ï¼ˆç¨åCLIé¡¹ç›®ä¸­å¯ä»¥çœ‹åˆ°gradlew propertiesåˆ—å‡ºäº†ä¸€å †projectçš„å±æ€§ï¼‰ã€‚<br><a href="https://docs.gradle.org/current/dsl/" target="_blank" rel="noopener">build.gradleçš„DSLå‚è€ƒ</a></p>
</blockquote>
</li>
<li>gradlew/gradlew.bat<blockquote>
<p>åˆ†åˆ«ç”¨äºç±»unixç³»ç»Ÿå’Œwindowsç³»ç»Ÿä¸‹çš„wrapperè„šæœ¬ï¼Œä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºäº†wrapperåæˆ‘ä»¬æ‰€æœ‰çš„æŒ‡ä»¤éƒ½é€šè¿‡wrapperè„šæœ¬æ¥æ‰§è¡Œ</p>
</blockquote>
</li>
<li>settings.gradle<blockquote>
<p>ä¸å¤šæ¨¡å—é¡¹ç›®é…ç½®æœ‰å…³çš„æ–‡ä»¶ï¼Œç”¨äºæè¿°é¡¹ç›®æ¨¡å—ä¹‹é—´çš„å…³ç³»</p>
</blockquote>
</li>
</ul>
<h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p>åˆ›å»ºå¥½é¡¹ç›®åå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æœ‰è®¸å¤šé…ç½®å¥½çš„ä¸œè¥¿äº†ï¼Œå¦‚junitä¾èµ–ã€Gradle wrapperç­‰ï¼Œæ‰€ä»¥ç°åœ¨å·²æˆ‘ä»¬ç›´æ¥å¯ä»¥ç›´æ¥å†™å•å…ƒæµ‹è¯•</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GettingStarted</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSimply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello gradle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡º</p>
<pre class="line-numbers language-text"><code class="language-text">hello gradle
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="Getting-Started-CLI"><a href="#Getting-Started-CLI" class="headerlink" title="Getting Started - CLI"></a>Getting Started - CLI</h2><p>ä½¿ç”¨ideå†™ä¸ªGradleçš„Hello Worldç¡®å®éå¸¸ç®€å•ï¼Œä½†ä½¿ç”¨CLIæ¥æ­å»ºé¡¹ç›®ï¼Œèƒ½è®©æˆ‘ä»¬å¯¹Gradleæœ‰æ›´åŠ æ·±å…¥çš„äº†è§£ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å°è¯•ç”¨CLIå†™ä¸€ä¸ªHello Worldã€‚</p>
<h3 id="å®‰è£…Gradle"><a href="#å®‰è£…Gradle" class="headerlink" title="å®‰è£…Gradle"></a>å®‰è£…Gradle</h3><p>ç”±äºæˆ‘ä»¬è¿™æ¬¡ç”¨çš„æ˜¯CLIï¼Œæ‰€ä»¥å¿…é¡»æ‰‹åŠ¨å®‰è£…Gradleã€‚<br>ä»¥æˆ‘ç”¨çš„MacOSä¸ºä¾‹ï¼Œæ‰“å¼€terminalï¼Œrun</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ brew install gradle
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å®‰è£…å‰å¿…é¡»ç¡®ä¿å®‰è£…äº†<code>jdk1.7</code>ä»¥ä¸Šç‰ˆæœ¬ï¼ˆæˆ‘ç”¨çš„Gradle 4.1ç‰ˆæœ¬çš„è¦æ±‚ï¼‰ï¼Œå…¶å®ƒç³»ç»Ÿç”¨æˆ·å¯ä»¥å‚è€ƒ<a href="https://gradle.org/install/" target="_blank" rel="noopener">Installation</a></p>
<p>ç„¶årunï¼Œè‹¥å·²æˆåŠŸå®‰è£…å¯ä»¥çœ‹åˆ°</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ gradle --version
------------------------------------------------------------
Gradle 4.1
------------------------------------------------------------

Build time:   2017-08-07 14:38:48 UTC
Revision:     941559e020f6c357ebb08d5c67acdb858a3defc2

Groovy:       2.4.11
Ant:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015
JVM:          1.8.0_121 (Oracle Corporation 25.121-b13)
OS:           Mac OS X 10.12.4 x86_64
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h3><p>åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ä½œä¸ºå·¥ç¨‹ç›®å½•ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªbuild.gradleç©ºæ–‡ä»¶</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ mkdir gradle_cli
$ cd gradle_cli
$ touch build.gradle
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”ŸæˆGradle Wrapper</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ gradle wrapper
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•çš„å˜åŒ–</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ tree .
.
â”œâ”€â”€ build.gradle
â”œâ”€â”€ gradle
â”‚   â””â”€â”€ wrapper
â”‚       â”œâ”€â”€ gradle-wrapper.jar
â”‚       â””â”€â”€ gradle-wrapper.properties
â”œâ”€â”€ gradlew
â””â”€â”€ gradlew.bat
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç°åœ¨å¯ä»¥é€šè¿‡wrapperè„šæœ¬æ¥æ‰§è¡Œå„é¡¹ä»»åŠ¡ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ›´æ¢äº†ç¯å¢ƒåä¾ç„¶èƒ½ä½¿ç”¨åˆ›å»ºé¡¹ç›®æ—¶ä½¿ç”¨çš„Gradleç‰ˆæœ¬è¿›è¡Œæ„å»ºã€‚</p>
<p>æŸ¥çœ‹propertiesä¿¡æ¯ï¼ˆä»¥ä¸‹è¾“å‡ºåšäº†å¤§é‡åˆ å‡ï¼‰</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew properties
> Task :properties

------------------------------------------------------------
Root project
------------------------------------------------------------

allprojects: [root project 'gradle_cli']
ant: org.gradle.api.internal.project.DefaultAntBuilder@70e298ee
â€¦â€¦
buildDir: /Users/tac/Documents/studyspace/src/java/gradle_cli/build
buildFile: /Users/tac/Documents/studyspace/src/java/gradle_cli/build.gradle
buildScriptSource: org.gradle.groovy.scripts.UriScriptSource@460e8e7a
â€¦â€¦
depth: 0
description: null
displayName: root project 'gradle_cli'
â€¦â€¦
gradle: build 'gradle_cli'
group:
â€¦â€¦
plugins: [org.gradle.api.plugins.HelpTasksPlugin@23fb712b]
â€¦â€¦
project: root project 'gradle_cli'
â€¦â€¦
projectDir: /Users/tac/Documents/studyspace/src/java/gradle_cli
â€¦â€¦
repositories: repository container
resources: org.gradle.api.internal.resources.DefaultResourceHandler@7cad9556
rootDir: /Users/tac/Documents/studyspace/src/java/gradle_cli
rootProject: root project 'gradle_cli'
â€¦â€¦
state: project state 'EXECUTED'
status: release
subprojects: []
tasks: task set
version: unspecified
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°å…¶ä¸­å¤§å¤šæ•°å±æ€§éƒ½å·²ç»æœ‰äº†é»˜è®¤çš„å€¼ï¼Œè¿™ä¹Ÿæ°å¥½éªŒè¯äº†Gradleçº¦å®šä¼˜äºé…ç½®çš„åŸåˆ™ã€‚<br>å¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›å±æ€§å€¼ï¼Œå¯ä»¥é€šè¿‡å†™build.gradleæ–‡ä»¶æ¥è¿›è¡Œé…ç½®</p>
<pre class="line-numbers language-groovy"><code class="language-groovy">description <span class="token operator">=</span> <span class="token string">'A Gradle build project for CLI'</span>
version <span class="token operator">=</span> <span class="token string">'1.0'</span>
group <span class="token operator">=</span> <span class="token string">'cn.tac.test'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å†æ¬¡æŸ¥çœ‹propertieså¯ä»¥çœ‹åˆ°å±æ€§å·²ç»æ›´æ”¹äº†</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew properties | grep -E "group|description|version"
description: A Gradle build project for CLI
group: cn.tac.test
version: 1.0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tip</strong></p>
<ul>
<li>ä½ ä¹Ÿå¯ä»¥å…ˆç”ŸæˆWrapperå†åˆ›å»ºbuild.gradleï¼Œå¹¶ä¸ä¼šæœ‰å½±å“</li>
<li>é™¤äº†æ‰‹åŠ¨åˆ›å»ºä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>gradle init</code>æŒ‡ä»¤æ¥åˆå§‹åŒ–é¡¹ç›®ã€‚åˆå§‹åŒ–çš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œgradle wrapperï¼Œä»¥åŠè‡ªåŠ¨ç”Ÿæˆbuild.gradleå’Œsettings.gradleï¼Œå¹¶ä¸”ç”Ÿæˆçš„æ–‡ä»¶é‡Œé¢å·²ç»æœ‰äº†ä¸€äº›è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®ï¼ˆé»˜è®¤æ˜¯æ³¨é‡ŠçŠ¶æ€ï¼Œå³æœªå¯ç”¨ï¼‰ã€‚</li>
</ul>
<h3 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h3><p>ç”±äºæˆ‘ä»¬æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ç©ºbuild.gradleï¼Œè¦æ„å»ºjavaé¡¹ç›®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›ç®€å•çš„é…ç½®ã€‚<br>åœ¨build.gradleåŠ å…¥ç›®æ ‡å·¥ç¨‹è¯­è¨€ï¼ˆä¸Šé¢æè¿‡ï¼ŒGradleæ˜¯æ”¯æŒå¤šè¯­è¨€çš„ï¼‰åŠç‰ˆæœ¬ã€ä¾èµ–åŠä¸‹è½½ä¾èµ–çš„ä»“åº“çš„é…ç½®</p>
<pre class="line-numbers language-groovy"><code class="language-groovy">apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    testCompile group<span class="token punctuation">:</span> <span class="token string">'junit'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'junit'</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token string">'4.12'</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>tips</strong></p>
<ul>
<li>å¯ä»¥é€šè¿‡<code>dependencies</code>ä»»åŠ¡æŸ¥çœ‹å½“å‰é¡¹ç›®çš„ä¾èµ–ä¿¡æ¯ã€‚</li>
</ul>
<h3 id="Hello-World-1"><a href="#Hello-World-1" class="headerlink" title="Hello World"></a>Hello World</h3><p>é…ç½®å¥½ç¯å¢ƒåï¼Œæˆ‘ä»¬åˆ›å»ºæºç ç›®å½•åŠå•å…ƒæµ‹è¯•ç±»</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ mkdir -p src/main/java src/main/resources src/test/java src/test/resources
$ cd src/test/java
$ mkdir -p cn/tac/test
$ cd cn/tac/test
$ touch HelloWorld.java
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åæ‰§è¡Œæ„å»ºï¼Œå¦‚æœä¸çŸ¥é“æœ‰å“ªäº›taskså¯ä»¥æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew tasks

> Task :tasks

------------------------------------------------------------
All tasks runnable from root project - A Gradle build project for CLI
------------------------------------------------------------

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
â€¦â€¦
Build Setup tasks
-----------------
init - Initializes a new Gradle build.
wrapper - Generates Gradle wrapper files.
Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.
Help tasks
----------
â€¦â€¦
Verification tasks
------------------
check - Runs all checks.
test - Runs the unit tests.

Rules
-----
â€¦â€¦
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-shell"><code class="language-shell">$ sh gradlew build
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å®Œäº†å¯ä»¥çœ‹è§é¡¹ç›®æ ¹ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªbuildç›®å½•ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯æ‰§è¡Œæ„å»ºçš„äº§ç‰©ã€‚ä¸Mavenä¸åŒçš„æ˜¯ï¼Œæœ‰ä¸ªreportsç›®å½•æ˜¯Gradleç”Ÿæˆçš„HTMLæ ¼å¼çš„æ„å»ºæŠ¥å‘Šï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€æŸ¥çœ‹<br><img src="/images/gradle_build_reports.jpg" alt="build reports"></p>
<p><strong>tip</strong></p>
<ul>
<li>æœ‰æ²¡æœ‰å‘ç°sh gradlew taskså‡ºæ¥çš„åˆ—è¡¨æœ‰ç‚¹åƒIDEA Gradle Projecté¢æ¿ä¸Šçš„tasksèŠ‚ç‚¹ï¼ŸğŸ˜ƒ</li>
<li>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ä½¿ç”¨gradleè·Ÿgradlewæ‰§è¡Œtaskçš„æ•ˆæœåŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºgradleä¼šä½¿ç”¨æœ¬åœ°å®‰è£…çš„Gradleç‰ˆæœ¬è¿›è¡Œæ„å»ºï¼Œè€Œgradlewä¼šä½¿ç”¨åˆ›å»ºé¡¹ç›®æ—¶ä½¿ç”¨çš„gradleç‰ˆæœ¬è¿›è¡Œæ„å»ºï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰æœç´¢åˆ°è¿™ä¸ªç‰ˆæœ¬ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸‹è½½</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="taccisum"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">taccisum</p>
  <div class="site-description" itemprop="description">el psy congroo.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/taccisum" title="GitHub â†’ https://github.com/taccisum" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/taccisum@gmail.com" title="G-Mail â†’ taccisum@gmail.com"><i class="fa fa-envelope fa-fw"></i>G-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">taccisum</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'q1GTC85aQcIvQIf3p9tWLTvW-gzGzoHsz',
      appKey     : 'OjWCd5UV1xcOyCEfsSzu9w7z',
      placeholder: "æ¬¢è¿ç•…æ‰€æ¬²è¨€",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
